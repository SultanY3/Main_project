 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\manage.py 
================================================================================ 
#!/usr/bin/env python
"""Django's command-line utility for administrative tasks."""
import os
import sys


def main():
    """Run administrative tasks."""
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'gohanhub.settings')
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError(
            "Couldn't import Django. Are you sure it's installed and "
            "available on your PYTHONPATH environment variable? Did you "
            "forget to activate a virtual environment?"
        ) from exc
    execute_from_command_line(sys.argv)


if __name__ == '__main__':
    main()
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\backend.txt 
================================================================================ 
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\manage.py 
================================================================================ 
#!/usr/bin/env python
"""Django's command-line utility for administrative tasks."""
import os
import sys


def main():
    """Run administrative tasks."""
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'gohanhub.settings')
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError(
            "Couldn't import Django. Are you sure it's installed and "
            "available on your PYTHONPATH environment variable? Did you "
            "forget to activate a virtual environment?"
        ) from exc
    execute_from_command_line(sys.argv)


if __name__ == '__main__':
    main()
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\backend.txt 
================================================================================ 
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\manage.py 
================================================================================ 
#!/usr/bin/env python
"""Django's command-line utility for administrative tasks."""
import os
import sys


def main():
    """Run admini 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\gohanhub\asgi.py 
================================================================================ 
"""
ASGI config for gohanhub project.

It exposes the ASGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/howto/deployment/asgi/
"""

import os

from django.core.asgi import get_asgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'gohanhub.settings')

application = get_asgi_application()
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\gohanhub\authentication_backends.py 
================================================================================ 
# gohanhub/authentication_backends.py
from django.contrib.auth.backends import BaseBackend
from django.contrib.auth.models import User

class EmailAuthenticationBackend(BaseBackend):
    """
    Custom authentication backend to allow login with email.
    """
    def authenticate(self, request, email=None, password=None, **kwargs):
        if email is None or password is None:
            return None
        
        try:
            user = User.objects.get(email=email)
            if user.check_password(password) and self.user_can_authenticate(user):
                return user
        except User.DoesNotExist:
            return None

    def get_user(self, user_id):
        try:
            return User.objects.get(pk=user_id)
        except User.DoesNotExist:
            return None 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\gohanhub\settings.py 
================================================================================ 
"""
Django settings for gohanhub project.

Generated by 'django-admin startproject' using Django 5.2.6.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/5.2/ref/settings/
"""

import os
from pathlib import Path
from datetime import timedelta
from dotenv import load_dotenv

# Load environment variables from .env file
load_dotenv()

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/5.2/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'django-insecure-oyr5!9p&yvt70a+m6nsx%45cmo=ay+o383j(c@6m7qdbjm_)*o'

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = []


# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'recipes',
    'rest_framework',
    'rest_framework.authtoken',
    'corsheaders',
    'drf_yasg',
    'django.contrib.sites',
    'allauth',
    'allauth.account',
    'allauth.socialaccount',
    'allauth.socialaccount.providers.google',
    'dj_rest_auth',
    'dj_rest_auth.registration',
    'users',  # Custom serializers module for auth customization
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'corsheaders.middleware.CorsMiddleware',
    'django.middleware.common.CommonMiddleware',
    'allauth.account.middleware.AccountMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

ROOT_URLCONF = 'gohanhub.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [os.path.join(BASE_DIR, 'templates')],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

WSGI_APPLICATION = 'gohanhub.wsgi.application'


# Database
# https://docs.djangoproject.com/en/5.2/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}


# Password validation
# https://docs.djangoproject.com/en/5.2/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
        'OPTIONS': {
            'min_length': 8,
        }
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]


# Internationalization
# https://docs.djangoproject.com/en/5.2/topics/i18n/

LANGUAGE_CODE = 'en-us'

TIME_ZONE = 'UTC'

USE_I18N = True

USE_TZ = True


# Email settings
EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'
EMAIL_HOST = 'smtp.gmail.com'
EMAIL_PORT = 587
EMAIL_USE_TLS = True
EMAIL_HOST_USER = os.environ.get('EMAIL_HOST_USER', '')
EMAIL_HOST_PASSWORD = os.environ.get('EMAIL_APP_PASSWORD', '')
DEFAULT_FROM_EMAIL = EMAIL_HOST_USER or 'no-reply@example.com'


# Media files
MEDIA_URL = '/media/'
MEDIA_ROOT = BASE_DIR / 'media'


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/5.2/howto/static-files/

STATIC_URL = 'static/'
STATICFILES_DIRS = [os.path.join(BASE_DIR, 'static')]


# Default primary key field type
# https://docs.djangoproject.com/en/5.2/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'


# Login redirect
LOGIN_URL = '/login/'


# Django REST Framework settings
REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'rest_framework_simplejwt.authentication.JWTAuthentication',
        'rest_framework.authentication.SessionAuthentication',
    ],
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.IsAuthenticatedOrReadOnly',
    ],
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    'PAGE_SIZE': 10
}


# ========================================
# django-allauth Configuration (v0.50+ dictionary format)
# ========================================

# Enable username field (Django User model requires it)
ACCOUNT_USER_MODEL_USERNAME_FIELD = 'username'

# Define signup fields as dictionary (NEW format)
ACCOUNT_SIGNUP_FIELDS = {
    'username': {
        'required': True,
        'min_length': 3,
        'max_length': 150,
    },
    'email': {
        'required': True,
        'verifiable': True,
    },
    'password1': {
        'required': True,
    },
    'password2': {
        'required': True,
    },
}

# Email verification ('none', 'optional', or 'mandatory')
ACCOUNT_EMAIL_VERIFICATION = 'none'

# Unique email addresses
ACCOUNT_UNIQUE_EMAIL = True

# Allow users to login immediately after registration
ACCOUNT_LOGIN_ON_EMAIL_CONFIRMATION = False


# ========================================
# dj-rest-auth Configuration
# ========================================

# Use JWT authentication
REST_USE_JWT = True
JWT_AUTH_COOKIE = 'jwt'
JWT_AUTH_REFRESH_COOKIE = 'refresh'

# Custom serializers
REST_AUTH_SERIALIZERS = {
    'LOGIN_SERIALIZER': 'users.serializers.CustomLoginSerializer',
    'USER_DETAILS_SERIALIZER': 'users.serializers.CustomUserSerializer',
}

REST_AUTH_REGISTER_SERIALIZERS = {
    'REGISTER_SERIALIZER': 'users.serializers.CustomRegisterSerializer',
}


# ========================================
# JWT Settings (Simple JWT)
# ========================================

SIMPLE_JWT = {
    'ACCESS_TOKEN_LIFETIME': timedelta(days=1),
    'REFRESH_TOKEN_LIFETIME': timedelta(days=7),
    'ROTATE_REFRESH_TOKENS': False,
    'BLACKLIST_AFTER_ROTATION': True,
    'UPDATE_LAST_LOGIN': True,
    
    'ALGORITHM': 'HS256',
    'SIGNING_KEY': SECRET_KEY,
    'VERIFYING_KEY': None,
    'AUDIENCE': None,
    'ISSUER': None,
    
    'AUTH_HEADER_TYPES': ('Bearer',),
    'AUTH_HEADER_NAME': 'HTTP_AUTHORIZATION',
    'USER_ID_FIELD': 'id',
    'USER_ID_CLAIM': 'user_id',
    
    'AUTH_TOKEN_CLASSES': ('rest_framework_simplejwt.tokens.AccessToken',),
    'TOKEN_TYPE_CLAIM': 'token_type',
}


# ========================================
# Authentication Backends
# ========================================

AUTHENTICATION_BACKENDS = [
    'gohanhub.authentication_backends.EmailAuthenticationBackend',  # Custom email login
    'django.contrib.auth.backends.ModelBackend',                    # Default Django auth
    'allauth.account.auth_backends.AuthenticationBackend',          # Allauth (for social)
]


# ========================================
# CORS Settings
# ========================================

CORS_ALLOWED_ORIGINS = [
    "http://localhost:3000",
    "http://localhost:3001",
    "http://127.0.0.1:3000",
    "http://127.0.0.1:3001",
    "https://claude.ai",
]

CORS_ALLOW_CREDENTIALS = True

CORS_ALLOW_METHODS = [
    'DELETE',
    'GET',
    'OPTIONS',
    'PATCH',
    'POST',
    'PUT',
]

# Allow specific headers
CORS_ALLOW_HEADERS = [
    'accept',
    'accept-encoding',
    'authorization',
    'content-type',
    'dnt',
    'origin',
    'user-agent',
    'x-csrftoken',
    'x-requested-with',
]


# ========================================
# Site Framework (for django-allauth)
# ========================================

SITE_ID = int(os.environ.get('SITE_ID', 1))


# ========================================
# Social Authentication (Google OAuth)
# ========================================

SOCIALACCOUNT_PROVIDERS = {
    'google': {
        'SCOPE': [
            'profile',
            'email',
        ],
        'AUTH_PARAMS': {
            'access_type': 'online',
        },
        'APP': {
            'client_id': os.environ.get('GOOGLE_OAUTH_CLIENT_ID', ''),
            'secret': os.environ.get('GOOGLE_OAUTH_CLIENT_SECRET', ''),
            'key': ''
        }
    }
}

# Auto-signup for social authentication
SOCIALACCOUNT_AUTO_SIGNUP = True

# Email is always required even for social auth
SOCIALACCOUNT_EMAIL_REQUIRED = True


# ========================================
# AI / Generative Model Settings (Chatbot)
# ========================================

# Primary API key (supports both Google Gemini and OpenAI)
GENERATIVE_AI_API_KEY = os.environ.get('GENERATIVE_AI_API_KEY', os.environ.get('OPENAI_API_KEY', ''))

# Model to use (default: Gemini)
GENERATIVE_AI_MODEL = os.environ.get('GENERATIVE_AI_MODEL', 'gemini-pro')

# API endpoint pattern
GENERATIVE_AI_ENDPOINT_PATTERN = os.environ.get(
    'GENERATIVE_AI_ENDPOINT_PATTERN',
    'https://generativelanguage.googleapis.com/v1beta/models/{model}:generateContent'
)

# Backwards compatibility
OPENAI_API_KEY = os.environ.get('OPENAI_API_KEY', '')


# ========================================
# Cache Settings (for rate limiting)
# ========================================

CACHES = {
    'default': {
        'BACKEND': 'django.core.cache.backends.locmem.LocMemCache',
        'LOCATION': 'unique-snowflake',
    }
}


# ========================================
# Security Settings (Production)
# ========================================

# Uncomment these for production
# SECURE_SSL_REDIRECT = True
# SESSION_COOKIE_SECURE = True
# CSRF_COOKIE_SECURE = True
# SECURE_BROWSER_XSS_FILTER = True
# SECURE_CONTENT_TYPE_NOSNIFF = True
# X_FRAME_OPTIONS = 'DENY' 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\gohanhub\urls.py 
================================================================================ 
from django.contrib import admin
from django.urls import path, include
from recipes import views
from django.conf import settings  
from django.conf.urls.static import static

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', views.home, name='home'),
    path('register/', views.register, name='register'),
    path('login/', views.Login, name='login'),
    path('logout/', views.Logout, name='logout'),
    path('profile/', views.profile, name='profile'),
    path('profile/update/', views.update_profile, name='update_profile'),
    path('add_recipe/', views.add_recipe, name='add_recipe'),
    path('recipe/<int:id>/', views.recipe_detail, name='recipe_detail'),
    path('recipe/<int:id>/favorite/', views.toggle_favorite, name='toggle_favorite'),
    path('recipe/<int:id>/edit/', views.edit_recipe, name='edit_recipe'),
    path('recipe/<int:id>/delete/', views.delete_recipe, name='delete_recipe'),
    path('favorites/', views.my_favorites, name='my_favorites'),
    # Admin URLs
    path('manage-users/', views.manage_users, name='manage_users'),
    path('manage-recipes/', views.manage_recipes, name='manage_recipes'),
    path('delete_user/<int:user_id>/', views.delete_user, name='delete_user'),
    path('admin-home/', views.admin_home, name='admin_home'),
    # API URLs
    path('api/', include('recipes.api_urls')),
]

# âœ… serve media files in development
if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\gohanhub\wsgi.py 
================================================================================ 
"""
WSGI config for gohanhub project.

It exposes the WSGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/howto/deployment/wsgi/
"""

import os

from django.core.wsgi import get_wsgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'gohanhub.settings')

application = get_wsgi_application()
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\gohanhub\__init__.py 
================================================================================ 
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\admin.py 
================================================================================ 
from django.contrib import admin
from .models import Recipe, Category, Ingredient, Favorite

# Register your models here.
admin.site.register(Recipe)
admin.site.register(Category)
admin.site.register(Ingredient)
admin.site.register(Favorite) 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\api_urls.py 
================================================================================ 
from django.urls import path, include
from rest_framework.routers import DefaultRouter
from rest_framework_simplejwt.views import (
    TokenObtainPairView,
    TokenRefreshView,
)
from drf_yasg.views import get_schema_view
from drf_yasg import openapi
from rest_framework import permissions
from . import api_views, follow_views

# Create schema view for Swagger/OpenAPI documentation
schema_view = get_schema_view(
    openapi.Info(
        title="GohanHub API",
        default_version='v1',
        description="API for GohanHub recipe sharing platform",
        terms_of_service="https://www.google.com/policies/terms/",
        contact=openapi.Contact(email="contact@gohanhub.local"),
        license=openapi.License(name="BSD License"),
    ),
    public=True,
    permission_classes=(permissions.AllowAny,),
)

# Create router and register viewsets
router = DefaultRouter()
router.register(r'recipes', api_views.RecipeViewSet, basename='recipe')
router.register(r'categories', api_views.CategoryViewSet, basename='category')
router.register(r'ingredients', api_views.IngredientViewSet, basename='ingredient')

# Swagger Decorator Helper Functions
def swagger_auto_schema_manual_parameters():
    return [
        openapi.Parameter(
            'rating',
            openapi.IN_BODY,
            description="Rating value between 1 and 5",
            type=openapi.TYPE_INTEGER,
            required=True,
            enum=[1, 2, 3, 4, 5]
        ),
    ]



# API URL patterns
urlpatterns = [
    # API root
    path('', include(router.urls)),

    # Authentication endpoints
    path('token/', TokenObtainPairView.as_view(), name='token_obtain_pair'),
    path('token/refresh/', TokenRefreshView.as_view(), name='token_refresh'),
    # dj-rest-auth endpoints (login/logout/password reset, registration)
    path('auth/', include('dj_rest_auth.urls')),
    path('auth/registration/', include('dj_rest_auth.registration.urls')),
    # Google social login endpoint (frontend should POST provider token here)
    path('auth/google/', api_views.GoogleLogin.as_view(), name='google-login'),

    # Follow system endpoints
    path('users/<int:user_id>/follow/', follow_views.FollowUserView.as_view(), name='follow-user'),
    path('users/<int:user_id>/unfollow/', follow_views.UnfollowUserView.as_view(), name='unfollow-user'),
    path('users/<int:user_id>/followers/', follow_views.UserFollowersView.as_view(), name='user-followers'),
    path('users/<int:user_id>/following/', follow_views.UserFollowingView.as_view(), name='user-following'),
    path('users/<int:user_id>/follow-status/', follow_views.check_follow_status, name='follow-status'),
    path('users/<int:user_id>/', follow_views.UserProfileView.as_view(), name='user-profile'),
    path('users/me/', follow_views.user_me_view, name='user-me'),
    # path('auth/register/', follow_views.register_view, name='register'),
    path('users/<int:user_id>/recipes/', follow_views.UserRecipesView.as_view(), name='user-recipes'),
    path('users/me/favorites/', follow_views.MyFavoritesView.as_view(), name='my-favorites'),
    path('feed/', api_views.PersonalizedFeedView.as_view(), name='personalized-feed'),

    # Rating and comment endpoints
    path('recipes/<int:pk>/rate/', api_views.RecipeViewSet.as_view({'post': 'rate'}), name='recipe-rate'),
    # Keep backward-compatible POST route and add pluralized route for consistency
    path('recipes/<int:pk>/comment/', api_views.RecipeViewSet.as_view({'post': 'comment'}), name='recipe-comment'),
    path('recipes/<int:pk>/comments/', api_views.RecipeViewSet.as_view({'get': 'comments', 'post': 'comment'}), name='recipe-comments'),
    
    # Notification endpoints
    path('notifications/', api_views.ListNotificationsView.as_view(), name='notifications-list'),
    path('notifications/count/', api_views.GetNotificationCountView.as_view(), name='notifications-count'),

    # Swagger/OpenAPI documentation
    path('docs/', schema_view.with_ui('swagger', cache_timeout=0), name='schema-swagger-ui'),
    path('redoc/', schema_view.with_ui('redoc', cache_timeout=0), name='schema-redoc'),
    # Chatbot / Generative AI endpoint
    path('chatbot/', api_views.ChatbotView.as_view(), name='chatbot'),
] 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\api_views.py 
================================================================================ 
from rest_framework import viewsets, permissions, filters, status, generics
from rest_framework.decorators import action
from rest_framework.response import Response
from django.db.models import Q, Count, Avg, Value, IntegerField, FloatField
from .models import Recipe, Category, Ingredient, Favorite, Follow, Rating, Comment
from .utils import create_comment_notification, create_rating_notification, recent_notifications_for_user
from .serializers import NotificationSerializer, CommentSerializer
from django.utils import timezone
from datetime import timedelta
from .serializers import (
    RecipeSerializer, CategorySerializer, IngredientSerializer,
    FavoriteSerializer, UserSerializer, FeedRecipeSerializer
)
from django.conf import settings
from django.core.cache import cache
import requests

# Social login imports
from dj_rest_auth.registration.views import SocialLoginView
from allauth.socialaccount.providers.google.views import GoogleOAuth2Adapter
from allauth.socialaccount.providers.oauth2.client import OAuth2Client

class IsOwnerOrReadOnly(permissions.BasePermission):
    def has_object_permission(self, request, view, obj):
        if request.method in permissions.SAFE_METHODS:
            return True
        return obj.author == request.user

# At the top of RecipeViewSet class
class RecipeViewSet(viewsets.ModelViewSet):
    queryset = Recipe.objects.all()
    serializer_class = RecipeSerializer
    permission_classes = [permissions.AllowAny]  # Change this temporarily for testing
    filter_backends = [filters.SearchFilter, filters.OrderingFilter]
    search_fields = ['title', 'description', 'ingredients__name']
    ordering_fields = ['created_at', 'title', 'average_rating']

    def perform_create(self, serializer):
        serializer.save(author=self.request.user)

    @action(detail=True, methods=['POST'], permission_classes=[permissions.IsAuthenticated])
    def rate(self, request, pk=None):
        recipe = self.get_object()
        user = request.user
        
        # Get the rating value from request data
        rating_value = request.data.get('rating')
        
        if not rating_value or not isinstance(rating_value, int) or not (1 <= rating_value <= 5):
            return Response(
                {'detail': 'Please provide a valid rating between 1 and 5'},
                status=status.HTTP_400_BAD_REQUEST
            )

        # Update or create the rating
        rating, created = Rating.objects.update_or_create(
            user=user,
            recipe=recipe,
            defaults={'rating': rating_value}
        )

        # Create notification for recipe author (skip if same user inside helper)
        try:
            create_rating_notification(user, recipe, rating_value)
        except Exception:
            pass

        return Response({
            'rating': rating_value,
            'average_rating': recipe.get_average_rating(),
            'rating_count': recipe.get_rating_count()
        })

    @action(detail=True, methods=['POST'], permission_classes=[permissions.IsAuthenticated])
    def comment(self, request, pk=None):
        recipe = self.get_object()
        text = request.data.get('text')
        
        if not text:
            return Response(
                {'detail': 'Please provide comment text'},
                status=status.HTTP_400_BAD_REQUEST
            )

        comment = Comment.objects.create(
            user=request.user,
            recipe=recipe,
            text=text
        )

        # Create notification for recipe author (skips if commenter is author)
        try:
            create_comment_notification(request.user, recipe)
        except Exception:
            pass

        serializer = CommentSerializer(comment, context={'request': request})
        return Response(serializer.data, status=status.HTTP_201_CREATED)

    @action(detail=True, methods=['GET'])
    def comments(self, request, pk=None):
        recipe = self.get_object()
        comments = recipe.comments.all().order_by('-created_at')
        page = self.paginate_queryset(comments)
        if page is not None:
            serializer = CommentSerializer(page, many=True, context={'request': request})
            return self.get_paginated_response(serializer.data)
        serializer = CommentSerializer(comments, many=True, context={'request': request})
        return Response(serializer.data)

    @action(detail=False, methods=['get'])
    def my_recipes(self, request):
        recipes = Recipe.objects.filter(author=request.user)
        serializer = self.get_serializer(recipes, many=True)
        return Response(serializer.data)

    @action(detail=False, methods=['get'])
    def search(self, request):
        query = request.query_params.get('q', '')
        if query:
            recipes = Recipe.objects.filter(
                Q(title__icontains=query) |
                Q(ingredients__name__icontains=query)
            ).distinct()
            serializer = self.get_serializer(recipes, many=True)
            return Response(serializer.data)
        return Response([])

    @action(detail=True, methods=['post'], permission_classes=[permissions.IsAuthenticated])
    def favorite(self, request, pk=None):
        recipe = self.get_object()
        user = request.user
        favorite, created = Favorite.objects.get_or_create(
            user=user,
            recipe=recipe
        )
        if not created:
            favorite.delete()
            return Response({'status': 'unfavorited'})
        return Response({'status': 'favorited'})

class CategoryViewSet(viewsets.ModelViewSet):
    queryset = Category.objects.all()
    serializer_class = CategorySerializer
    permission_classes = [permissions.IsAuthenticatedOrReadOnly]

class IngredientViewSet(viewsets.ModelViewSet):
    queryset = Ingredient.objects.all()
    serializer_class = IngredientSerializer
    permission_classes = [permissions.IsAuthenticatedOrReadOnly]
    filter_backends = [filters.SearchFilter]
    search_fields = ['name']

class PersonalizedFeedView(generics.ListAPIView):
    serializer_class = FeedRecipeSerializer
    permission_classes = [permissions.IsAuthenticated]
    page_size = 15  # Set in pagination_class at runtime

    def get_queryset(self):
        following_users = Follow.objects.filter(follower=self.request.user).values_list('following', flat=True)
        return Recipe.objects.filter(author__in=following_users)\
            .annotate(
                likes_count=Count('favorited_by', distinct=True),
                comments_count=Value(0, output_field=IntegerField()),
                avg_rating=Value(0.0, output_field=FloatField())
            )\
            .order_by('-created_at', '-id')


class ListNotificationsView(generics.GenericAPIView):
    permission_classes = [permissions.IsAuthenticated]

    def get(self, request):
        cutoff = timezone.now() - timedelta(hours=1)
        notifications = recent_notifications_for_user(request.user, hours=1)
        serializer = NotificationSerializer(notifications, many=True)
        return Response(serializer.data)


class GetNotificationCountView(generics.GenericAPIView):
    permission_classes = [permissions.IsAuthenticated]

    def get(self, request):
        cutoff = timezone.now() - timedelta(hours=1)
        count = recent_notifications_for_user(request.user, hours=1).count()
        return Response({'count': count})


class GoogleLogin(SocialLoginView):
    """Endpoint to accept Google OAuth credential tokens from the frontend and
    exchange them for a user/token pair using dj-rest-auth + allauth.
    Frontend should POST the provider token to this endpoint.
    """
    adapter_class = GoogleOAuth2Adapter
    client_class = OAuth2Client
    callback_url = None


class ChatbotView(generics.GenericAPIView):
    permission_classes = [permissions.IsAuthenticated]

    def post(self, request):
        user = request.user
        message = request.data.get('message')

        if not message:
            return Response({'detail': 'Message is required'}, status=status.HTTP_400_BAD_REQUEST)

        # Rate limiting
        cache_key = f"chat_count_{user.id}"
        count = cache.get(cache_key)
        if count is None:
            cache.set(cache_key, 1, timeout=3600)
        else:
            if int(count) >= 10:
                return Response({'detail': 'Rate limit exceeded (10 requests per hour)'}, status=429)
            cache.incr(cache_key)

        # Get API key
        api_key = getattr(settings, 'GENERATIVE_AI_API_KEY', None)
        if not api_key:
            return Response({'detail': 'Chatbot API key not configured'}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)

        # Prepare prompt
        system_prompt = "You are a helpful cooking assistant. Provide cooking advice, ingredient substitutions, and recipe help."
        
        # Gemini API format
        url = f"https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key={api_key}"
        
        payload = {
            "contents": [{
                "parts": [{
                    "text": f"{system_prompt}\n\nUser: {message}"
                }]
            }]
        }

        headers = {'Content-Type': 'application/json'}

        try:
            resp = requests.post(url, json=payload, headers=headers, timeout=15)
            resp.raise_for_status()
            data = resp.json()

            # Extract text from Gemini response
            text = data.get('candidates', [{}])[0].get('content', {}).get('parts', [{}])[0].get('text', 'No response')

            return Response({'response': text})
        except requests.RequestException as e:
            return Response({'detail': 'Chatbot API request failed', 'error': str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)
        except Exception as e:
            return Response({'detail': 'Unexpected error', 'error': str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR) 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\apps.py 
================================================================================ 
from django.apps import AppConfig


class RecipesConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'recipes'
    
    def ready(self):
        # Import signals to ensure they are registered
        try:
            import recipes.signals  # noqa: F401
        except Exception:
            pass
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\follow_views.py 
================================================================================ 
from rest_framework import status, generics
from rest_framework.decorators import api_view, permission_classes
from rest_framework.response import Response
from rest_framework.permissions import IsAuthenticated, AllowAny
from rest_framework.pagination import PageNumberPagination
from django.shortcuts import get_object_or_404
from django.contrib.auth.models import User
from .models import Follow
from .utils import create_follow_notification
from .serializers import FollowSerializer, UserFollowStatsSerializer
from rest_framework.decorators import parser_classes
from rest_framework.parsers import MultiPartParser, FormParser
from recipes.serializers import RecipeSerializer
from recipes.models import Recipe, Favorite

class FollowPagination(PageNumberPagination):
    page_size = 10
    page_size_query_param = 'page_size'
    max_page_size = 100

class FollowUserView(generics.CreateAPIView):
    permission_classes = [IsAuthenticated]
    serializer_class = FollowSerializer

    def create(self, request, *args, **kwargs):
        target_user = get_object_or_404(User, id=self.kwargs['user_id'])
        
        if request.user == target_user:
            return Response(
                {"detail": "You cannot follow yourself."},
                status=status.HTTP_400_BAD_REQUEST
            )

        follow, created = Follow.objects.get_or_create(
            follower=request.user,
            following=target_user
        )

        if not created:
            return Response(
                {"detail": "You are already following this user."},
                status=status.HTTP_400_BAD_REQUEST
            )

        serializer = UserFollowStatsSerializer(
            target_user,
            context={'request': request}
        )
        # Create notification for the followed user
        try:
            create_follow_notification(request.user, target_user)
        except Exception:
            pass
        return Response(serializer.data, status=status.HTTP_201_CREATED)

class UnfollowUserView(generics.DestroyAPIView):
    permission_classes = [IsAuthenticated]

    def destroy(self, request, *args, **kwargs):
        target_user = get_object_or_404(User, id=self.kwargs['user_id'])
        
        try:
            follow = Follow.objects.get(
                follower=request.user,
                following=target_user
            )
            follow.delete()
            serializer = UserFollowStatsSerializer(
                target_user,
                context={'request': request}
            )
            return Response(serializer.data)
        except Follow.DoesNotExist:
            return Response(
                {"detail": "You are not following this user."},
                status=status.HTTP_400_BAD_REQUEST
            )

class UserFollowersView(generics.ListAPIView):
    serializer_class = UserFollowStatsSerializer
    pagination_class = FollowPagination

    def get_queryset(self):
        user = get_object_or_404(User, id=self.kwargs['user_id'])
        return User.objects.filter(following__following=user)

class UserFollowingView(generics.ListAPIView):
    serializer_class = UserFollowStatsSerializer
    pagination_class = FollowPagination

    def get_queryset(self):
        user = get_object_or_404(User, id=self.kwargs['user_id'])
        return User.objects.filter(followers__follower=user)

@api_view(['GET'])
@permission_classes([IsAuthenticated])
def check_follow_status(request, user_id):
    target_user = get_object_or_404(User, id=user_id)
    
    if request.user == target_user:
        return Response({
            "is_following": None,
            "message": "This is your own profile"
        })

    is_following = Follow.objects.filter(
        follower=request.user,
        following=target_user
    ).exists()

    return Response({
        "is_following": is_following
    })


class UserProfileView(generics.RetrieveAPIView):
    """Retrieve basic user profile info plus follow stats."""
    serializer_class = UserFollowStatsSerializer
    # Allow public access to view user profile/stats; follow/unfollow actions still require auth
    permission_classes = [AllowAny]

    def get_object(self):
        user = get_object_or_404(User, id=self.kwargs['user_id'])
        return user


@api_view(['GET'])
@permission_classes([IsAuthenticated])
def user_me_view(request):
    """Return profile/stats for the current authenticated user."""
    serializer = UserFollowStatsSerializer(request.user, context={'request': request})
    return Response(serializer.data)


@api_view(['POST'])
@permission_classes([AllowAny])
def register_view(request):
    """Register a new user. Expects username, email, password."""
    username = request.data.get('username')
    email = request.data.get('email')
    password = request.data.get('password')

    if not username or not password:
        return Response({'detail': 'Username and password are required.'}, status=status.HTTP_400_BAD_REQUEST)

    if User.objects.filter(username=username).exists():
        return Response({'detail': 'Username already exists.'}, status=status.HTTP_400_BAD_REQUEST)

    user = User.objects.create_user(username=username, email=email, password=password)
    serializer = UserFollowStatsSerializer(user, context={'request': request})
    return Response(serializer.data, status=status.HTTP_201_CREATED)


class UserRecipesView(generics.ListAPIView):
    """List recipes authored by a given user."""
    serializer_class = RecipeSerializer
    pagination_class = FollowPagination

    def get_queryset(self):
        user = get_object_or_404(User, id=self.kwargs['user_id'])
        return Recipe.objects.filter(author=user).order_by('-created_at')


class MyFavoritesView(generics.ListAPIView):
    """List recipes favorited by the current user."""
    serializer_class = RecipeSerializer
    pagination_class = FollowPagination
    permission_classes = [IsAuthenticated]

    def get_queryset(self):
        return Recipe.objects.filter(favorite__user=self.request.user).distinct().order_by('-created_at') 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\models.py 
================================================================================ 
from django.db import models
from django.contrib.auth.models import User


class Ingredient(models.Model):
    name = models.CharField(max_length=100, unique=True)  

    def __str__(self):
        return self.name

class Category(models.Model):
    name = models.CharField(max_length=100, unique=True)

    def __str__(self):
        return self.name


class Recipe(models.Model):
    author = models.ForeignKey(User, on_delete=models.CASCADE)
    title = models.CharField(max_length=200)
    description = models.TextField(blank=True)
    instructions = models.TextField()
    ingredients = models.ManyToManyField(Ingredient, blank=True)
    category = models.ForeignKey(Category, on_delete=models.SET_NULL, null=True, blank=True)
    image = models.ImageField(upload_to='recipe_images/', blank=True, null=True) 
    created_at = models.DateTimeField(auto_now_add=True)
    favorited_by = models.ManyToManyField(User, through='Favorite', related_name='favorite_recipes')

    def __str__(self):
        return self.title
    
    def get_average_rating(self):
        ratings = self.ratings.all()
        if not ratings:
            return None
        return sum(r.rating for r in ratings) / len(ratings)

    def get_rating_count(self):
        return self.ratings.count()


class Favorite(models.Model):
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    recipe = models.ForeignKey(Recipe, on_delete=models.CASCADE)

    class Meta:
        unique_together = ('user', 'recipe')

class Follow(models.Model):
    follower = models.ForeignKey(
        User,
        on_delete=models.CASCADE,
        related_name='following',
        verbose_name='Who is following'
    )
    following = models.ForeignKey(
        User,
        on_delete=models.CASCADE,
        related_name='followers',
        verbose_name='Who is being followed'
    )
    created_at = models.DateTimeField(auto_now_add=True)

    class Meta:
        unique_together = ('follower', 'following')
        ordering = ['-created_at']

    def __str__(self):
        return f"{self.follower.username} follows {self.following.username}"

    def save(self, *args, **kwargs):
        if self.follower == self.following:
            raise ValueError("Users cannot follow themselves.")
        super().save(*args, **kwargs)


class Rating(models.Model):
    RATING_CHOICES = [
        (1, '1 - Poor'),
        (2, '2 - Fair'),
        (3, '3 - Good'),
        (4, '4 - Very Good'),
        (5, '5 - Excellent')
    ]

    user = models.ForeignKey(User, on_delete=models.CASCADE, related_name='ratings')
    recipe = models.ForeignKey(Recipe, on_delete=models.CASCADE, related_name='ratings')
    rating = models.IntegerField(choices=RATING_CHOICES)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        unique_together = ('user', 'recipe')
        indexes = [
            models.Index(fields=['recipe', '-created_at']),
        ]
        ordering = ['-created_at']

    def __str__(self):
        return f"{self.user.username} rated {self.recipe.title}: {self.rating} stars"

    def clean(self):
        if not 1 <= self.rating <= 5:
            raise models.ValidationError('Rating must be between 1 and 5')
        super().clean()

    def save(self, *args, **kwargs):
        self.clean()
        super().save(*args, **kwargs)


class Comment(models.Model):
    user = models.ForeignKey(User, on_delete=models.CASCADE, related_name='comments')
    recipe = models.ForeignKey(Recipe, on_delete=models.CASCADE, related_name='comments')
    text = models.TextField()
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        ordering = ['-created_at']
        indexes = [
            models.Index(fields=['recipe', '-created_at']),
        ]

    def __str__(self):
        return f"Comment by {self.user.username} on {self.recipe.title}"


class Notification(models.Model):
    NOTIFICATION_TYPES = [
        ('follow', 'Follow'),
        ('comment', 'Comment'),
        ('rating', 'Rating'),
    ]

    recipient = models.ForeignKey(User, on_delete=models.CASCADE, related_name='notifications')
    sender = models.ForeignKey(User, on_delete=models.CASCADE, null=True, blank=True, related_name='sent_notifications')
    notification_type = models.CharField(max_length=20, choices=NOTIFICATION_TYPES)
    recipe = models.ForeignKey(Recipe, on_delete=models.CASCADE, null=True, blank=True)
    message = models.TextField()
    created_at = models.DateTimeField(auto_now_add=True)

    class Meta:
        ordering = ['-created_at']

    def __str__(self):
        return f"Notification to {self.recipient.username}: {self.notification_type} - {self.message[:50]}"
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\serializers.py 
================================================================================ 
from rest_framework import serializers
from django.contrib.auth.models import User
from .models import Recipe, Category, Ingredient, Favorite, Follow, Rating, Comment
from django.db.models import Count, Avg
from .models import Notification
from django.utils.timesince import timesince
from django.utils import timezone
from dj_rest_auth.serializers import LoginSerializer
from dj_rest_auth.registration.serializers import RegisterSerializer

class FeedRecipeSerializer(serializers.ModelSerializer):
    author = serializers.SerializerMethodField()
    likes_count = serializers.IntegerField(read_only=True)
    comments_count = serializers.IntegerField(read_only=True)
    avg_rating = serializers.FloatField(read_only=True)
    is_favorite = serializers.SerializerMethodField()

    class Meta:
        model = Recipe
        fields = ['id', 'title', 'description', 'image', 'author', 
                 'created_at', 'likes_count', 'comments_count', 
                 'avg_rating', 'is_favorite']

    def get_author(self, obj):
        return {
            'username': obj.author.username,
            'profile_picture': None  # Placeholder for profile picture functionality
        }
    
    def get_is_favorite(self, obj):
        request = self.context.get('request')
        if request and request.user.is_authenticated:
            return Favorite.objects.filter(user=request.user, recipe=obj).exists()
        return False

class UserSerializer(serializers.ModelSerializer):
    class Meta:
        model = User
        fields = ('id', 'username', 'email', 'first_name', 'last_name')
        read_only_fields = ('id',)

class CategorySerializer(serializers.ModelSerializer):
    class Meta:
        model = Category
        fields = ('id', 'name')
        read_only_fields = ('id',)

class IngredientSerializer(serializers.ModelSerializer):
    class Meta:
        model = Ingredient
        fields = ('id', 'name')
        read_only_fields = ('id',)

class FavoriteSerializer(serializers.ModelSerializer):
    class Meta:
        model = Favorite
        fields = ('id', 'user', 'recipe')
        read_only_fields = ('id', 'user')

class RecipeSerializer(serializers.ModelSerializer):
    author = UserSerializer(read_only=True)
    # Read nested category, accept write via category_id
    category = CategorySerializer(read_only=True)
    category_id = serializers.PrimaryKeyRelatedField(queryset=Category.objects.all(), write_only=True, source='category', required=False, allow_null=True)
    ingredients = IngredientSerializer(many=True)
    is_favorite = serializers.SerializerMethodField()
    average_rating = serializers.SerializerMethodField()
    rating_count = serializers.SerializerMethodField()
    user_rating = serializers.SerializerMethodField()
    comment_count = serializers.SerializerMethodField()

    class Meta:
        model = Recipe
        fields = ('id', 'author', 'title', 'description', 'instructions', 
                 'ingredients', 'category', 'category_id', 'image', 'created_at',
                 'is_favorite', 'average_rating', 'rating_count', 'user_rating',
                 'comment_count')
        read_only_fields = ('id', 'created_at', 'author')

    def get_is_favorite(self, obj):
        request = self.context.get('request')
        if request and request.user.is_authenticated:
            return Favorite.objects.filter(user=request.user, recipe=obj).exists()
        return False

    def get_average_rating(self, obj):
        return obj.get_average_rating()

    def get_rating_count(self, obj):
        return obj.get_rating_count()

    def get_user_rating(self, obj):
        request = self.context.get('request')
        if request and request.user.is_authenticated:
            try:
                rating = Rating.objects.get(user=request.user, recipe=obj)
                return rating.rating
            except Rating.DoesNotExist:
                return None
        return None

    def get_comment_count(self, obj):
        return obj.comments.count()

    def create(self, validated_data):
        ingredients_data = validated_data.pop('ingredients', [])
        # 'category' may already be a Category instance because of category_id write field
        category = validated_data.get('category', None)

        # Create recipe
        recipe = Recipe.objects.create(**validated_data)

        # Handle ingredients
        for ingredient_data in ingredients_data:
            ingredient, _ = Ingredient.objects.get_or_create(**ingredient_data)
            recipe.ingredients.add(ingredient)

        return recipe

    def update(self, instance, validated_data):
        ingredients_data = validated_data.pop('ingredients', [])
        # 'category' may be present as a Category instance via category_id
        category = validated_data.get('category', None)
        if category is not None:
            instance.category = category

        # Update recipe fields
        for attr, value in validated_data.items():
            setattr(instance, attr, value)
        instance.save()

        # Update ingredients
        if ingredients_data:
            instance.ingredients.clear()
            for ingredient_data in ingredients_data:
                ingredient, _ = Ingredient.objects.get_or_create(**ingredient_data)
                instance.ingredients.add(ingredient)

        return instance

class FollowSerializer(serializers.ModelSerializer):
    follower = UserSerializer(read_only=True)
    following = UserSerializer(read_only=True)

    class Meta:
        model = Follow
        fields = ('id', 'follower', 'following', 'created_at')
        read_only_fields = ('id', 'created_at')

class UserFollowStatsSerializer(serializers.ModelSerializer):
    follower_count = serializers.SerializerMethodField()
    following_count = serializers.SerializerMethodField()
    is_following = serializers.SerializerMethodField()
    recipes_count = serializers.SerializerMethodField()

    class Meta:
        model = User
        fields = ('id', 'username', 'first_name', 'last_name', 'follower_count', 
                 'following_count', 'is_following', 'recipes_count')

    def get_follower_count(self, obj):
        return obj.followers.count()

    def get_following_count(self, obj):
        return obj.following.count()

    def get_is_following(self, obj):
        request = self.context.get('request')
        if request and request.user.is_authenticated:
            if request.user == obj:
                return None  # Cannot follow self
            return Follow.objects.filter(follower=request.user, following=obj).exists()
        return False

    def get_recipes_count(self, obj):
        return Recipe.objects.filter(author=obj).count()


class RatingSerializer(serializers.ModelSerializer):
    user = UserSerializer(read_only=True)
    
    class Meta:
        model = Rating
        fields = ('id', 'user', 'recipe', 'rating', 'created_at')
        read_only_fields = ('id', 'created_at', 'user')

    def validate_rating(self, value):
        if not 1 <= value <= 5:
            raise serializers.ValidationError('Rating must be between 1 and 5.')
        return value


class CommentSerializer(serializers.ModelSerializer):
    user = UserSerializer(read_only=True)
    is_owner = serializers.SerializerMethodField()

    class Meta:
        model = Comment
        fields = ('id', 'user', 'recipe', 'text', 'created_at', 'updated_at', 'is_owner')
        read_only_fields = ('id', 'created_at', 'updated_at', 'user')

    def get_is_owner(self, obj):
        request = self.context.get('request')
        if request and request.user.is_authenticated:
            return obj.user == request.user
        return False


class NotificationSerializer(serializers.ModelSerializer):
    sender = serializers.SerializerMethodField()
    recipe = serializers.SerializerMethodField()
    time_ago = serializers.SerializerMethodField()

    class Meta:
        model = Notification
        fields = ('id', 'sender', 'notification_type', 'recipe', 'message', 'created_at', 'time_ago')

    def get_sender(self, obj):
        if not obj.sender:
            return None
        return {
            'id': obj.sender.id,
            'username': obj.sender.username,
            'profile_picture': None
        }

    def get_recipe(self, obj):
        if not obj.recipe:
            return None
        return {
            'id': obj.recipe.id,
            'title': obj.recipe.title
        }

    def get_time_ago(self, obj):
        return timesince(obj.created_at, timezone.now()) + ' ago' 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\signals.py 
================================================================================ 
from django.contrib.auth import get_user_model
from django.db.models.signals import post_save
from django.dispatch import receiver
from .notifications.email_utils import send_welcome_email

User = get_user_model()


@receiver(post_save, sender=User)
def send_welcome_on_create(sender, instance, created, **kwargs):
    # only send when a new user is created
    if created:
        try:
            send_welcome_email(instance)
        except Exception:
            # keep silent on failures; errors are logged in utility
            pass
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\tests.py 
================================================================================ 
from django.test import TestCase
from django.contrib.auth.models import User
from rest_framework.test import APITestCase
from rest_framework import status
from django.urls import reverse
from recipes.models import Follow, Recipe, Category
from django.db import IntegrityError
from datetime import datetime

class FollowTests(TestCase):
    def setUp(self):
        self.user1 = User.objects.create_user(username='user1', password='pass123!')
        self.user2 = User.objects.create_user(username='user2', password='pass123!')

    def test_follow_creation(self):
        follow = Follow.objects.create(follower=self.user1, following=self.user2)
        self.assertEqual(follow.follower, self.user1)
        self.assertEqual(follow.following, self.user2)
        self.assertTrue(isinstance(follow.created_at, datetime))

    def test_prevent_self_follow(self):
        with self.assertRaises(ValueError):
            Follow.objects.create(follower=self.user1, following=self.user1)

    def test_prevent_duplicate_follow(self):
        Follow.objects.create(follower=self.user1, following=self.user2)
        with self.assertRaises(IntegrityError):
            Follow.objects.create(follower=self.user1, following=self.user2)

class FollowAPITests(APITestCase):
    def setUp(self):
        self.user1 = User.objects.create_user(username='user1', password='pass123!')
        self.user2 = User.objects.create_user(username='user2', password='pass123!')
        self.user3 = User.objects.create_user(username='user3', password='pass123!')
        
        # Create some test data
        self.category = Category.objects.create(name='Test Category')
        self.recipe = Recipe.objects.create(
            author=self.user2,
            title='Test Recipe',
            description='Test Description',
            instructions='Test Instructions',
            category=self.category
        )

        # Authenticate user1
        self.client.force_authenticate(user=self.user1)

    def test_follow_user(self):
        url = reverse('follow-user', args=[self.user2.id])
        response = self.client.post(url)
        
        self.assertEqual(response.status_code, status.HTTP_201_CREATED)
        self.assertTrue(Follow.objects.filter(
            follower=self.user1,
            following=self.user2
        ).exists())
        self.assertEqual(response.data['follower_count'], 1)
        self.assertTrue(response.data['is_following'])

    def test_unfollow_user(self):
        # Create follow first
        Follow.objects.create(follower=self.user1, following=self.user2)
        
        url = reverse('unfollow-user', args=[self.user2.id])
        response = self.client.delete(url)
        
        self.assertEqual(response.status_code, status.HTTP_200_OK)
        self.assertFalse(Follow.objects.filter(
            follower=self.user1,
            following=self.user2
        ).exists())
        self.assertEqual(response.data['follower_count'], 0)
        self.assertFalse(response.data['is_following'])

    def test_follow_status(self):
        url = reverse('follow-status', args=[self.user2.id])
        
        # Check initial status (not following)
        response = self.client.get(url)
        self.assertEqual(response.status_code, status.HTTP_200_OK)
        self.assertFalse(response.data['is_following'])
        
        # Follow and check status
        Follow.objects.create(follower=self.user1, following=self.user2)
        response = self.client.get(url)
        self.assertTrue(response.data['is_following'])

    def test_followers_list(self):
        # Create follows
        Follow.objects.create(follower=self.user1, following=self.user2)
        Follow.objects.create(follower=self.user3, following=self.user2)
        
        url = reverse('user-followers', args=[self.user2.id])
        response = self.client.get(url)
        
        self.assertEqual(response.status_code, status.HTTP_200_OK)
        self.assertEqual(len(response.data['results']), 2)  # Paginated response

    def test_following_list(self):
        # Create follows
        Follow.objects.create(follower=self.user1, following=self.user2)
        Follow.objects.create(follower=self.user1, following=self.user3)
        
        url = reverse('user-following', args=[self.user1.id])
        response = self.client.get(url)
        
        self.assertEqual(response.status_code, status.HTTP_200_OK)
        self.assertEqual(len(response.data['results']), 2)  # Paginated response

class FavoriteAPITests(APITestCase):
    def setUp(self):
        self.user1 = User.objects.create_user(username='user1', password='pass123!')
        self.user2 = User.objects.create_user(username='user2', password='pass123!')
        self.category = Category.objects.create(name='Test Category')
        self.recipe = Recipe.objects.create(
            author=self.user2,
            title='Test Recipe',
            description='Test Description',
            instructions='Test Instructions',
            category=self.category
        )
        
        # Authenticate user1
        self.client.force_authenticate(user=self.user1)

    def test_favorite_recipe(self):
        url = reverse('recipe-favorite', args=[self.recipe.id])
        response = self.client.post(url)
        
        self.assertEqual(response.status_code, status.HTTP_200_OK)
        self.assertEqual(response.data['status'], 'favorited')
        self.assertTrue(self.recipe.favorited_by.filter(id=self.user1.id).exists())

    def test_unfavorite_recipe(self):
        # Favorite first
        self.recipe.favorited_by.add(self.user1)
        
        url = reverse('recipe-favorite', args=[self.recipe.id])
        response = self.client.post(url)  # Same endpoint toggles favorite status
        
        self.assertEqual(response.status_code, status.HTTP_200_OK)
        self.assertEqual(response.data['status'], 'unfavorited')
        self.assertFalse(self.recipe.favorited_by.filter(id=self.user1.id).exists())

    def test_my_favorites(self):
        # Create and favorite multiple recipes
        recipe2 = Recipe.objects.create(
            author=self.user2,
            title='Another Recipe',
            description='Another Description',
            instructions='More Instructions',
            category=self.category
        )
        
        self.recipe.favorited_by.add(self.user1)
        recipe2.favorited_by.add(self.user1)
        
        url = reverse('my-favorites')
        response = self.client.get(url)
        
        self.assertEqual(response.status_code, status.HTTP_200_OK)
        self.assertEqual(len(response.data['results']), 2)  # Paginated response

class PersonalizedFeedTests(APITestCase):
    def setUp(self):
        self.user1 = User.objects.create_user(username='user1', password='pass123!')
        self.user2 = User.objects.create_user(username='user2', password='pass123!')
        self.user3 = User.objects.create_user(username='user3', password='pass123!')
        
        self.category = Category.objects.create(name='Test Category')
        
        # Create recipes for user2 and user3
        self.recipe1 = Recipe.objects.create(
            author=self.user2,
            title='User2 Recipe 1',
            description='Test Description',
            instructions='Test Instructions',
            category=self.category
        )
        
        self.recipe2 = Recipe.objects.create(
            author=self.user3,
            title='User3 Recipe 1',
            description='Test Description',
            instructions='Test Instructions',
            category=self.category
        )
        
        # Authenticate user1
        self.client.force_authenticate(user=self.user1)

    def test_feed_shows_followed_users_recipes(self):
        # User1 follows User2 but not User3
        Follow.objects.create(follower=self.user1, following=self.user2)
        
        url = reverse('personalized-feed')
        response = self.client.get(url)
        
        self.assertEqual(response.status_code, status.HTTP_200_OK)
        self.assertEqual(len(response.data['results']), 1)
        self.assertEqual(response.data['results'][0]['id'], self.recipe1.id)
        self.assertEqual(response.data['results'][0]['author']['username'], self.user2.username)
        
    def test_feed_empty_when_not_following(self):
        url = reverse('personalized-feed')
        response = self.client.get(url)
        
        self.assertEqual(response.status_code, status.HTTP_200_OK)
        self.assertEqual(len(response.data['results']), 0)

    def test_feed_ordered_by_created_at(self):
        # Follow both users
        Follow.objects.create(follower=self.user1, following=self.user2)
        Follow.objects.create(follower=self.user1, following=self.user3)
        
        # Create a newer recipe for user2
        recipe3 = Recipe.objects.create(
            author=self.user2,
            title='User2 Recipe 2',
            description='Newer Recipe',
            instructions='Test Instructions',
            category=self.category
        )
        
        url = reverse('personalized-feed')
        response = self.client.get(url)
        
        self.assertEqual(response.status_code, status.HTTP_200_OK)
        self.assertEqual(len(response.data['results']), 3)
        self.assertEqual(response.data['results'][0]['id'], recipe3.id)

    def test_feed_requires_authentication(self):
        self.client.force_authenticate(user=None)
        url = reverse('personalized-feed')
        response = self.client.get(url)
        
        self.assertEqual(response.status_code, status.HTTP_401_UNAUTHORIZED)
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\tests_chatbot.py 
================================================================================ 
from django.test import TestCase
from rest_framework.test import APITestCase
from django.contrib.auth.models import User
from django.urls import reverse
from unittest.mock import patch, Mock
from rest_framework import status
import json

class ChatbotAPITests(APITestCase):
    def setUp(self):
        self.user = User.objects.create_user(username='tester', password='pass123')
        self.client.force_authenticate(user=self.user)
        self.url = reverse('chatbot')
        # Ensure tests have a generative AI key configured
        from django.conf import settings as dj_settings
        dj_settings.GENERATIVE_AI_API_KEY = 'test-key'
        # Clear cache so rate-limit counters don't leak between tests
        from django.core.cache import cache
        cache.clear()

    @patch('recipes.api_views.requests.post')
    def test_chatbot_success(self, mock_post):
        # Mock a successful generative AI response
        mock_resp = Mock()
        mock_resp.raise_for_status = Mock()
        mock_resp.json.return_value = {
            'candidates': [
                {'content': 'This is a helpful cooking answer.'}
            ]
        }
        mock_post.return_value = mock_resp

        response = self.client.post(self.url, {'message': 'How do I boil an egg?'}, format='json')
        self.assertEqual(response.status_code, status.HTTP_200_OK)
        self.assertIn('response', response.data)
        self.assertEqual(response.data['response'], 'This is a helpful cooking answer.')

    @patch('recipes.api_views.requests.post')
    def test_chatbot_rate_limit(self, mock_post):
        # Ensure rate limiting after 10 requests
        mock_resp = Mock()
        mock_resp.raise_for_status = Mock()
        mock_resp.json.return_value = {'candidates': [{'content': 'ok'}]}
        mock_post.return_value = mock_resp

        for i in range(10):
            r = self.client.post(self.url, {'message': f'msg {i}'}, format='json')
            self.assertEqual(r.status_code, status.HTTP_200_OK)

        # 11th should be rate limited
        r = self.client.post(self.url, {'message': 'one more'}, format='json')
        self.assertEqual(r.status_code, 429)
        self.assertIn('error', r.data)
        self.assertEqual(r.data['error'], 'Rate limit exceeded (10 requests per hour)')
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\utils.py 
================================================================================ 
from django.utils import timezone
from datetime import timedelta
from .models import Notification


def create_follow_notification(follower, following):
    # follower started following following
    if follower == following:
        return None
    message = f"{follower.username} started following you"
    return Notification.objects.create(
        recipient=following,
        sender=follower,
        notification_type='follow',
        message=message
    )


def create_comment_notification(commenter, recipe):
    # Skip if commenter is recipe author
    if commenter == recipe.author:
        return None
    message = f"{commenter.username} commented on your recipe: {recipe.title}"
    return Notification.objects.create(
        recipient=recipe.author,
        sender=commenter,
        notification_type='comment',
        recipe=recipe,
        message=message
    )


def create_rating_notification(rater, recipe, rating):
    if rater == recipe.author:
        return None
    message = f"{rater.username} gave {rating} star{'s' if rating != 1 else ''} to your recipe: {recipe.title}"
    return Notification.objects.create(
        recipient=recipe.author,
        sender=rater,
        notification_type='rating',
        recipe=recipe,
        message=message
    )


def recent_notifications_for_user(user, hours=1):
    cutoff = timezone.now() - timedelta(hours=hours)
    return Notification.objects.filter(recipient=user, created_at__gte=cutoff).order_by('-created_at')
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\views.py 
================================================================================ 
from django.shortcuts import render, redirect
from django.contrib.auth import authenticate, login, logout
from django.contrib.auth.models import User
from django.contrib.auth.decorators import login_required, user_passes_test
from django.http import HttpResponse
from django.contrib import messages
from .models import Recipe, Category, Favorite, Ingredient
from django.db.models import Q
import re


# -------------------- Authentication Views --------------------

def register(request):
    """
    Handles user registration with username, email, and password.
    Users must provide their own unique username.
    """
    categories = Category.objects.all().order_by('name')
    
    if request.method == 'POST':
        username = request.POST.get('username', '').strip()
        email = request.POST.get('email', '').strip()
        password = request.POST.get('password', '')
        confirm_password = request.POST.get('confirm_password', '')

        # Validation
        if not all([username, email, password, confirm_password]):
            messages.error(request, 'All fields are required.')
            return render(request, 'register.html', {'categories': categories})
        
        # Username validation
        if len(username) < 3:
            messages.error(request, 'Username must be at least 3 characters long.')
            return render(request, 'register.html', {'categories': categories})
        
        if len(username) > 150:
            messages.error(request, 'Username must be less than 150 characters.')
            return render(request, 'register.html', {'categories': categories})
        
        # Check username format (letters, numbers, @, ., +, -, _)
        if not re.match(r'^[a-zA-Z0-9@.+_-]+$', username):
            messages.error(request, 'Username can only contain letters, numbers, and @/./+/-/_ characters.')
            return render(request, 'register.html', {'categories': categories})
        
        # Check if username already exists
        if User.objects.filter(username=username).exists():
            messages.error(request, 'Username already exists. Please choose a different username.')
            return render(request, 'register.html', {'categories': categories})
        
        # Email validation
        if User.objects.filter(email=email.lower()).exists():
            messages.error(request, 'Email already exists.')
            return render(request, 'register.html', {'categories': categories})
        
        # Password validation
        if len(password) < 8:
            messages.error(request, 'Password must be at least 8 characters long.')
            return render(request, 'register.html', {'categories': categories})
        
        if password != confirm_password:
            messages.error(request, 'Passwords do not match.')
            return render(request, 'register.html', {'categories': categories})

        try:
            # Create user with lowercase email
            user = User.objects.create_user(
                username=username,
                email=email.lower(),
                password=password
            )
            messages.success(request, 'Account created successfully! Please log in.')
            return redirect('login')
        except Exception as e:
            messages.error(request, f'Registration failed: {str(e)}')
            return render(request, 'register.html', {'categories': categories})

    return render(request, 'register.html', {'categories': categories})


def Login(request):
    """
    Handles user login using email and password.
    Uses EmailAuthenticationBackend from settings.py.
    """
    categories = Category.objects.all().order_by('name')
    
    if request.method == 'POST':
        email = request.POST.get('email', '').strip()
        password = request.POST.get('password', '')

        if not all([email, password]):
            messages.error(request, 'Email and password are required.')
            return render(request, 'login.html', {'categories': categories})

        # Authenticate using email (EmailAuthenticationBackend in settings.py)
        user = authenticate(request, email=email.lower(), password=password)

        if user is not None:
            login(request, user)
            # Redirect based on user type
            if user.is_superuser:
                return redirect('admin_home')
            else:
                # Redirect to next parameter if present, otherwise home
                next_url = request.GET.get('next', 'home')
                return redirect(next_url)
        else:
            messages.error(request, 'Invalid email or password.')
            return render(request, 'login.html', {'categories': categories})
    
    return render(request, 'login.html', {'categories': categories})


@login_required(login_url='login')
def Logout(request):
    """Logs out the current user."""
    logout(request)
    messages.success(request, 'You have been logged out.')
    return redirect('home')


# -------------------- Page Views --------------------

def home(request):
    """
    Home page with recipe search and category filtering.
    """
    recipes = Recipe.objects.all().order_by('-created_at')
    search_query = request.GET.get('search', '').strip()
    category_name = request.GET.get('category', '').strip()

    if search_query:
        recipes = recipes.filter(
            Q(title__icontains=search_query) |
            Q(description__icontains=search_query) |
            Q(ingredients__name__icontains=search_query)
        ).distinct()

    if category_name:
        recipes = recipes.filter(category__name__iexact=category_name)

    categories = Category.objects.all().order_by('name')
    
    # Redirect admin users to admin dashboard
    if request.user.is_authenticated and request.user.is_superuser:
        return redirect('admin_home')
    
    return render(request, 'home.html', {
        'recipes': recipes, 
        'categories': categories,
        'search_query': search_query
    })


def admin_home(request):
    """Admin dashboard - only accessible by superusers."""
    if not request.user.is_superuser:
        messages.error(request, 'Access denied. Admin privileges required.')
        return redirect('home')
    
    # Get statistics
    total_users = User.objects.filter(is_superuser=False).count()
    total_recipes = Recipe.objects.count()
    total_categories = Category.objects.count()
    
    return render(request, 'admin_home.html', {
        'total_users': total_users,
        'total_recipes': total_recipes,
        'total_categories': total_categories,
    })


# -------------------- User Profile Views --------------------

@login_required(login_url='login')
def profile(request):
    """User profile showing their recipes."""
    categories = Category.objects.all().order_by('name')
    user_recipes = Recipe.objects.filter(author=request.user).order_by('-created_at')
    
    return render(request, 'profile.html', {
        'user': request.user, 
        'user_recipes': user_recipes, 
        'categories': categories,
        'recipes_count': user_recipes.count(),
    })


@login_required(login_url='login')
def update_profile(request):
    """Update user profile information."""
    categories = Category.objects.all().order_by('name')
    
    if request.method == 'POST':
        firstname = request.POST.get('firstname', '').strip()
        lastname = request.POST.get('lastname', '').strip()
        email = request.POST.get('email', '').strip()
        
        if not all([firstname, lastname, email]):
            messages.error(request, 'All fields are required.')
            return render(request, 'update_profile.html', {'categories': categories})
        
        # Check if email is already taken by another user
        if User.objects.filter(email=email.lower()).exclude(id=request.user.id).exists():
            messages.error(request, 'Email already exists.')
            return render(request, 'update_profile.html', {'categories': categories})
        
        # Update user information
        request.user.first_name = firstname
        request.user.last_name = lastname
        request.user.email = email.lower()
        request.user.save()
        
        messages.success(request, 'Profile updated successfully!')
        return redirect('profile')
    
    return render(request, 'update_profile.html', {'categories': categories})


# -------------------- Recipe CRUD Views --------------------

@login_required(login_url='login')
def add_recipe(request):
    """Create a new recipe."""
    categories = Category.objects.all().order_by('name')
    
    if request.method == 'POST':
        title = request.POST.get('title', '').strip()
        description = request.POST.get('description', '').strip()
        instructions = request.POST.get('instructions', '').strip()
        image = request.FILES.get('image')
        category_id = request.POST.get('category')
        ingredients_input = request.POST.get('ingredients', '').strip()

        # Validation
        if not title:
            messages.error(request, 'Title is required.')
            return render(request, 'add_recipe.html', {
                'all_categories': categories, 
                'categories': categories
            })
        
        if not instructions:
            messages.error(request, 'Instructions are required.')
            return render(request, 'add_recipe.html', {
                'all_categories': categories, 
                'categories': categories
            })

        # Create recipe
        recipe = Recipe.objects.create(
            author=request.user,
            title=title,
            description=description,
            instructions=instructions,
            image=image
        )

        # Set category if provided
        if category_id:
            try:
                recipe.category = Category.objects.get(id=category_id)
                recipe.save()
            except Category.DoesNotExist:
                messages.warning(request, 'Selected category not found.')

        # Add ingredients
        if ingredients_input:
            for ing in ingredients_input.split(','):
                ing_name = ing.strip()
                if ing_name:
                    ingredient, _ = Ingredient.objects.get_or_create(name=ing_name)
                    recipe.ingredients.add(ingredient)

        messages.success(request, 'Recipe added successfully!')
        return redirect('recipe_detail', id=recipe.id)

    return render(request, 'add_recipe.html', {
        'all_categories': categories, 
        'categories': categories
    })


@login_required(login_url='login')
def edit_recipe(request, id):
    """Edit an existing recipe."""
    try:
        # Admin can edit any recipe, regular users only their own
        if request.user.is_superuser:
            recipe = Recipe.objects.get(id=id)
        else:
            recipe = Recipe.objects.get(id=id, author=request.user)
    except Recipe.DoesNotExist:
        messages.error(request, "Recipe not found or you don't have permission to edit it.")
        return redirect('home')

    categories = Category.objects.all().order_by('name')
    
    if request.method == 'POST':
        recipe.title = request.POST.get('title', '').strip()
        recipe.description = request.POST.get('description', '').strip()
        recipe.instructions = request.POST.get('instructions', '').strip()
        
        # Validation
        if not recipe.title or not recipe.instructions:
            messages.error(request, 'Title and instructions are required.')
            return render(request, 'edit_recipe.html', {
                'recipe': recipe,
                'all_categories': categories, 
                'categories': categories
            })
        
        # Update category
        category_id = request.POST.get('category')
        if category_id:
            try:
                recipe.category = Category.objects.get(id=category_id)
            except Category.DoesNotExist:
                messages.warning(request, 'Selected category not found.')

        # Update image if provided
        if request.FILES.get('image'):
            recipe.image = request.FILES['image']

        recipe.save()

        # Update ingredients
        recipe.ingredients.clear()
        ingredients_input = request.POST.get('ingredients', '').strip()
        if ingredients_input:
            for ing in ingredients_input.split(','):
                ing_name = ing.strip()
                if ing_name:
                    ingredient, _ = Ingredient.objects.get_or_create(name=ing_name)
                    recipe.ingredients.add(ingredient)

        messages.success(request, 'Recipe updated successfully!')
        return redirect('recipe_detail', id=recipe.id)

    return render(request, 'edit_recipe.html', {
        'recipe': recipe, 
        'all_categories': categories, 
        'categories': categories
    })


@login_required(login_url='login')
def delete_recipe(request, id):
    """Delete a recipe."""
    try:
        # Admin can delete any recipe, regular users only their own
        if request.user.is_superuser:
            recipe = Recipe.objects.get(id=id)
        else:
            recipe = Recipe.objects.get(id=id, author=request.user)
    except Recipe.DoesNotExist:
        messages.error(request, "Recipe not found or you don't have permission to delete it.")
        return redirect('profile')

    if request.method == 'POST':
        recipe_title = recipe.title
        recipe.delete()
        messages.success(request, f'Recipe "{recipe_title}" deleted successfully!')
        return redirect('profile')
    
    # If GET request, show confirmation page
    return render(request, 'confirm_delete.html', {'recipe': recipe})


def recipe_detail(request, id):
    """Display recipe details."""
    try:
        recipe = Recipe.objects.get(id=id)
        is_favorite = False
        
        if request.user.is_authenticated:
            is_favorite = Favorite.objects.filter(user=request.user, recipe=recipe).exists()
        
        categories = Category.objects.all().order_by('name')
        
        # Get recipe ingredients as a list
        ingredients_list = recipe.ingredients.all()
        
        return render(request, 'recipe_detail.html', {
            'recipe': recipe, 
            'is_favorite': is_favorite, 
            'categories': categories,
            'ingredients_list': ingredients_list,
        })
    except Recipe.DoesNotExist:
        messages.error(request, 'Recipe not found.')
        return redirect('home')


# -------------------- Favorites Views --------------------

@login_required(login_url='login')
def toggle_favorite(request, id):
    """Toggle recipe favorite status."""
    try:
        recipe = Recipe.objects.get(id=id)
        favorite, created = Favorite.objects.get_or_create(user=request.user, recipe=recipe)
        
        if not created:
            favorite.delete()
            messages.success(request, f'Removed "{recipe.title}" from favorites!')
        else:
            messages.success(request, f'Added "{recipe.title}" to favorites!')
            
        return redirect('recipe_detail', id=id)
    except Recipe.DoesNotExist:
        messages.error(request, 'Recipe not found.')
        return redirect('home')


@login_required(login_url='login')
def my_favorites(request):
    """Display user's favorite recipes."""
    favorites = Favorite.objects.filter(user=request.user).select_related('recipe').order_by('-id')
    categories = Category.objects.all().order_by('name')
    
    return render(request, 'favorites.html', {
        'favorites': favorites,
        'categories': categories,
        'favorites_count': favorites.count(),
    })


# -------------------- Admin Views --------------------

def is_superuser(user):
    """Check if user is a superuser."""
    return user.is_authenticated and user.is_superuser


@user_passes_test(is_superuser)
def manage_users(request):
    """Admin view to manage users."""
    users = User.objects.filter(is_superuser=False).order_by('-date_joined')
    
    # Search functionality
    search_query = request.GET.get('search', '').strip()
    if search_query:
        users = users.filter(
            Q(username__icontains=search_query) |
            Q(email__icontains=search_query) |
            Q(first_name__icontains=search_query) |
            Q(last_name__icontains=search_query)
        )
    
    return render(request, 'manage_users.html', {
        'users': users,
        'search_query': search_query,
        'total_users': User.objects.filter(is_superuser=False).count(),
    })


@user_passes_test(is_superuser)
def delete_user(request, user_id):
    """Admin view to delete a user."""
    if request.method == 'POST':
        try:
            user = User.objects.get(id=user_id, is_superuser=False)
            username = user.username
            user.delete()
            messages.success(request, f'User "{username}" has been deleted.')
        except User.DoesNotExist:
            messages.error(request, 'User not found or cannot delete admin users.')
    
    return redirect('manage_users')


@user_passes_test(is_superuser)
def manage_recipes(request):
    """Admin view to manage all recipes with category filtering."""
    recipes = Recipe.objects.all().select_related('author', 'category').order_by('-created_at')
    
    # Category filter
    category_id = request.GET.get('category')
    if category_id:
        recipes = recipes.filter(category_id=category_id)
    
    # Search functionality
    search_query = request.GET.get('search', '').strip()
    if search_query:
        recipes = recipes.filter(
            Q(title__icontains=search_query) |
            Q(description__icontains=search_query) |
            Q(author__username__icontains=search_query)
        )
    
    categories = Category.objects.all().order_by('name')
    
    return render(request, 'manage_recipes.html', {
        'recipes': recipes,
        'categories': categories,
        'selected_category': category_id,
        'search_query': search_query,
        'total_recipes': Recipe.objects.count(),
    }) 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\__init__.py 
================================================================================ 
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\migrations\0001_initial.py 
================================================================================ 
# Generated by Django 5.2.6 on 2025-09-26 06:09

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Ingredient',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
            ],
        ),
        migrations.CreateModel(
            name='Recipe',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=200)),
                ('description', models.TextField(blank=True)),
                ('instructions', models.TextField()),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('author', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
                ('ingredients', models.ManyToManyField(blank=True, to='recipes.ingredient')),
            ],
        ),
        migrations.CreateModel(
            name='Favorite',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
                ('recipe', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='recipes.recipe')),
            ],
            options={
                'unique_together': {('user', 'recipe')},
            },
        ),
    ]
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\migrations\0002_recipe_image_alter_ingredient_name.py 
================================================================================ 
# Generated by Django 5.2.6 on 2025-09-26 10:31

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('recipes', '0001_initial'),
    ]

    operations = [
        migrations.AddField(
            model_name='recipe',
            name='image',
            field=models.ImageField(blank=True, null=True, upload_to='recipe_images/'),
        ),
        migrations.AlterField(
            model_name='ingredient',
            name='name',
            field=models.CharField(max_length=100, unique=True),
        ),
    ]
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\migrations\0003_category_recipe_category.py 
================================================================================ 
# Generated by Django 5.2.6 on 2025-09-30 16:21

import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('recipes', '0002_recipe_image_alter_ingredient_name'),
    ]

    operations = [
        migrations.CreateModel(
            name='Category',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, unique=True)),
            ],
        ),
        migrations.AddField(
            model_name='recipe',
            name='category',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='recipes.category'),
        ),
    ]
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\migrations\0004_add_default_categories.py 
================================================================================ 
from django.db import migrations

def create_default_categories(apps, schema_editor):
    Category = apps.get_model('recipes', 'Category')
    categories = [
        'Breakfast', 'Lunch', 'Dinner', 'Dessert', 'Snack',
        'Appetizer', 'Soup', 'Salad', 'Beverage',
        'Main Course', 'Side Dish', 'Vegetarian', 'Vegan'
    ]
    for cat in categories:
        Category.objects.get_or_create(name=cat)

class Migration(migrations.Migration):

    dependencies = [
        ('recipes', '0003_category_recipe_category'),  # update this
    ]

    operations = [
        migrations.RunPython(create_default_categories),
    ]
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\migrations\0005_reset_categories.py 
================================================================================ 
from django.db import migrations


NEW_CATEGORIES = [
    'Vegetarian',
    'Vegan',
    'Chicken',
    'Meat',
    'Fish',
    'Egg',
    'Desserts',
    'Snack',
    'Beverages',
]


def reset_categories(apps, schema_editor):
    Category = apps.get_model('recipes', 'Category')
    # Remove all existing categories
    Category.objects.all().delete()
    # Create the new set
    for name in NEW_CATEGORIES:
        Category.objects.get_or_create(name=name)


def noop(apps, schema_editor):
    # No-op reverse migration; we won't try to reconstruct previous categories
    pass


class Migration(migrations.Migration):

    dependencies = [
        ('recipes', '0004_add_default_categories'),
    ]

    operations = [
        migrations.RunPython(reset_categories, noop),
    ]



 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\migrations\0006_follow.py 
================================================================================ 
# Generated by Django 5.2.7 on 2025-10-31 06:30

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('recipes', '0005_reset_categories'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Follow',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('follower', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='following', to=settings.AUTH_USER_MODEL, verbose_name='Who is following')),
                ('following', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='followers', to=settings.AUTH_USER_MODEL, verbose_name='Who is being followed')),
            ],
            options={
                'ordering': ['-created_at'],
                'unique_together': {('follower', 'following')},
            },
        ),
    ]
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\migrations\0007_recipe_favorited_by.py 
================================================================================ 
# Generated by Django 5.2.7 on 2025-11-02 10:20

from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('recipes', '0006_follow'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.AddField(
            model_name='recipe',
            name='favorited_by',
            field=models.ManyToManyField(related_name='favorite_recipes', through='recipes.Favorite', to=settings.AUTH_USER_MODEL),
        ),
    ]
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\migrations\0008_rating_comment.py 
================================================================================ 
from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('recipes', '0007_recipe_favorited_by'),
    ]

    operations = [
        migrations.CreateModel(
            name='Rating',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('rating', models.IntegerField(choices=[(1, '1 - Poor'), (2, '2 - Fair'), (3, '3 - Good'), (4, '4 - Very Good'), (5, '5 - Excellent')])),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('recipe', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='ratings', to='recipes.recipe')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'unique_together': {('user', 'recipe')},
                'index_together': {('user', 'recipe')},
            },
        ),
        migrations.CreateModel(
            name='Comment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('text', models.TextField()),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('recipe', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='comments', to='recipes.recipe')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
    ] 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\migrations\0009_alter_rating_options_alter_comment_user_and_more.py 
================================================================================ 
# Generated by Django 5.2.7 on 2025-11-03 05:46

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('recipes', '0008_rating_comment'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.AlterModelOptions(
            name='rating',
            options={'ordering': ['-created_at']},
        ),
        migrations.AlterField(
            model_name='comment',
            name='user',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='comments', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AlterField(
            model_name='rating',
            name='user',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='ratings', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddIndex(
            model_name='comment',
            index=models.Index(fields=['recipe', '-created_at'], name='recipes_com_recipe__d91579_idx'),
        ),
        migrations.AddIndex(
            model_name='rating',
            index=models.Index(fields=['recipe', '-created_at'], name='recipes_rat_recipe__f5b1c5_idx'),
        ),
    ]
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\migrations\0010_notification.py 
================================================================================ 
from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion

class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('recipes', '0009_alter_rating_options_alter_comment_user_and_more'),
    ]

    operations = [
        migrations.CreateModel(
            name='Notification',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('notification_type', models.CharField(choices=[('follow', 'Follow'), ('comment', 'Comment'), ('rating', 'Rating')], max_length=20)),
                ('message', models.TextField()),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('recipe', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='recipes.recipe')),
                ('recipient', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='notifications', to=settings.AUTH_USER_MODEL)),
                ('sender', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='sent_notifications', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
    ]
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\migrations\__init__.py 
================================================================================ 
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\recipes\notifications\email_utils.py 
================================================================================ 
from django.template.loader import render_to_string
from django.core.mail import EmailMultiAlternatives
from django.conf import settings
import logging

logger = logging.getLogger(__name__)


def send_welcome_email(user):
    try:
        subject = "Welcome to GohanHub!"
        site_url = getattr(settings, 'SITE_URL', 'http://localhost:3000')
        context = {
            'username': user.username,
            'email': user.email,
            'site_url': site_url,
        }
        html_content = render_to_string('emails/welcome.html', context)
        text_content = f"Hi {user.username},\n\nWelcome to GohanHub! Visit {site_url} to get started."

        from_email = settings.DEFAULT_FROM_EMAIL
        to = [user.email]

        msg = EmailMultiAlternatives(subject, text_content, from_email, to)
        msg.attach_alternative(html_content, "text/html")
        msg.send()
        logger.info(f"Sent welcome email to {user.email}")
    except Exception as e:
        logger.exception(f"Failed to send welcome email to {getattr(user, 'email', None)}: {e}")
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\static\css\Custom.css 
================================================================================ 
/* Minimal Custom Styles for GohanHub */

/* Recipe Card Consistent Size */
.recipe-card {
    height: 400px; 
    overflow: hidden; 
    border-radius: 0.5rem;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    display: flex;
    flex-direction: column;
    cursor: pointer;
}

.recipe-card img {
    height: 200px;
    width: 100%;
    object-fit: cover;
    border-top-left-radius: 0.5rem;
    border-top-right-radius: 0.5rem;
}

    
.recipe-card .card-body {
    padding: 1rem;
    flex-grow: 1; 
}

     
.recipe-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
} 




.recipe-image {
    width: 100%;
    height: 400px;
    object-fit: cover;
}



/* Basic spacing */
.page-header {
    margin-bottom: 1.5rem;
    font-weight: bold;
}

/* Ingredient and instruction lists */
.ingredients-list,
.instructions-list {
    background-color: #f8f9fa; /* Bootstrap light gray */
    padding: 1rem;
    border-radius: 0.5rem;
}

/* Keep auth forms centered */
.auth-container {
    max-width: 450px;
    margin: 2rem auto;
} 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\templates\add_recipe.html 
================================================================================ 
{% extends 'base.html' %}

{% block content %}
<div class="container">
    <h2 class="text-center mb-4">Add New Recipe</h2>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data">
                        {% csrf_token %}

                        <div class="mb-3">
                            <label for="title" class="form-label">Recipe Title *</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="title" 
                                   name="title" 
                                   required 
                                   placeholder="e.g., Chocolate Chip Cookies">
                        </div>

                        <div class="mb-3">
                            <label for="category" class="form-label">Category *</label>
                            <select class="form-control" id="category" name="category" required>
                                <option value="">Select a category</option>
                                {% for cat in all_categories %}
                                    <option value="{{ cat.id }}">{{ cat.name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control" 
                                      id="description" 
                                      name="description" 
                                      rows="3" 
                                      placeholder="Brief description of your recipe..."></textarea>
                        </div>

                        <div class="mb-3">
                            <label for="ingredients" class="form-label">Ingredients</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="ingredients" 
                                   name="ingredients" 
                                   placeholder="e.g., flour, sugar, eggs, butter">
                            <small class="form-text text-muted">Separate ingredients with commas</small>
                        </div>

                        <div class="mb-3">
                            <label for="instructions" class="form-label">Instructions *</label>
                            <textarea class="form-control" 
                                      id="instructions" 
                                      name="instructions" 
                                      rows="8" 
                                      required 
                                      placeholder="Step 1: Preheat oven to 350Â°F&#10;Step 2: Mix dry ingredients&#10;Step 3: ..."></textarea>
                            <small class="form-text text-muted">Write each step on a new line</small>
                        </div>

                        <div class="mb-3">
                            <label for="image" class="form-label">Recipe Image</label>
                            <input type="file" 
                                   class="form-control" 
                                   id="image" 
                                   name="image" 
                                   accept="image/*">
                        </div>

                        <div class="d-flex justify-content-between">
                            <a href="{% url 'home' %}" class="btn btn-secondary">Cancel</a>
                            <button type="submit" class="btn btn-primary">Add Recipe</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\templates\admin_home.html 
================================================================================ 
{% extends 'base.html' %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-12 text-center mb-5">
            <h1 class="display-4">Admin Panel</h1>
            <p class="lead text-muted">Manage your recipe sharing platform</p>
        </div>
    </div>

    <!-- Main Management Cards -->
    <div class="row g-4 mb-4">
        <div class="col-md-6">
            <div class="card h-100 shadow-sm">
                <div class="card-body text-center p-5">
                    <h2 class="mb-3">Manage Users</h2>
                    <p class="text-muted mb-4">View and delete user accounts</p>
                    <a href="{% url 'manage_users' %}" class="btn btn-primary btn-lg">
                        Go to Users
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card h-100 shadow-sm">
                <div class="card-body text-center p-5">
                    <h2 class="mb-3">Manage Recipes</h2>
                    <p class="text-muted mb-4">View and delete recipes from all users</p>
                    <a href="{% url 'manage_recipes' %}" class="btn btn-success btn-lg">
                        Go to Recipes
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\templates\base.html 
================================================================================ 
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GohanHub - Recipe Sharing Platform</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/custom.css' %}">
    
    <style>
        /* Offcanvas styling */
        .offcanvas-category {
            width: 280px !important;
        }
        
        .offcanvas-header {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            color: white;
        }
        
        .category-list {
            padding: 0;
        }
        
        .category-item {
            padding: 12px 20px;
            border-bottom: 1px solid #e5e7eb;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .category-item:hover {
            background-color: #f0fdf4;
            padding-left: 25px;
        }
        
        .category-item.active {
            background-color: #d1fae5;
            border-left: 4px solid #059669;
            font-weight: 600;
        }
        
        .category-item i {
            margin-right: 10px;
            color: #059669;
        }
        
        .category-badge {
            background-color: #059669;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
        }
        
        .hamburger-btn {
            border: none;
            background: none;
            font-size: 1.5rem;
            color: #059669;
            cursor: pointer;
            padding: 0.25rem 0.5rem;
            transition: all 0.2s;
        }
        
        .hamburger-btn:hover {
            color: #047857;
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <!-- Hamburger Menu Button -->
            {% if not user.is_superuser %}
                <button class="hamburger-btn me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#categoryMenu">
                    Menu
                </button>
            {% endif %}
            
            <a class="navbar-brand" href="{% url 'home' %}">
                GohanHub
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    {% if user.is_authenticated %}
                        {% if not user.is_superuser %}
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'my_favorites' %}">
                                    Favorites
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'profile' %}">
                                    Profile
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'add_recipe' %}">
                                    Add Recipe
                                </a>
                            </li>
                        {% endif %}
                        <li class="nav-item">
                            <a class="nav-link logout" href="{% url 'logout' %}">
                                Logout
                            </a>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'login' %}">
                                Login
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'register' %}">
                                Register
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <!-- Category Offcanvas Menu -->
    <div class="offcanvas offcanvas-start offcanvas-category" tabindex="-1" id="categoryMenu">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title">Categories</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body p-0">
            <div class="category-list">
                <!-- All Recipes -->
                <a href="{% url 'home' %}"
                   class="category-item text-decoration-none text-dark d-block {% if not request.GET.category %}active{% endif %}"
                   onclick="window.location.href=this.href;">
                    <span>All Recipes</span>
                </a>
                
                <!-- Dynamic Categories -->
                {% for category in categories %}
                <a href="{% url 'home' %}?category={{ category.name|urlencode }}" 
                   class="category-item text-decoration-none text-dark d-block {% if request.GET.category and request.GET.category|lower == category.name|lower %}active{% endif %}"
                   onclick="window.location.href=this.href;">
                    <span>{{ category.name|title }}</span>
                </a>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mt-4">
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-success-custom alert-dismissible fade show" role="alert">
                    <i class="bi bi-check-circle"></i> {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
        
        {% block content %}{% endblock %}
    </div>

    <!-- Footer -->
    <footer class="py-4 mt-5">
        <div class="container text-center">
            <p class="mb-0">&copy; 2025 GohanHub. All rights reserved.</p>
            <small class="text-muted">Share your favorite recipes with the world!</small>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\templates\edit_recipe.html 
================================================================================ 
{% extends 'base.html' %}

{% block content %}
<div class="container">
    <h2 class="text-center mb-4">Edit Recipe</h2>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data">
                        {% csrf_token %}

                        <div class="mb-3">
                            <label for="title" class="form-label">Recipe Title *</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="title" 
                                   name="title" 
                                   value="{{ recipe.title|default:'' }}" 
                                   required 
                                   placeholder="e.g., Chocolate Chip Cookies">
                        </div>

                        <div class="mb-3">
                            <label for="category" class="form-label">Category *</label>
                            <select class="form-control" id="category" name="category" required>
                                <option value="">Select a category</option>
                                {% for cat in all_categories %}
                                    <option value="{{ cat.id }}" 
                                        {% if recipe and recipe.category and recipe.category.id == cat.id %}selected{% endif %}>
                                        {{ cat.name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control" 
                                      id="description" 
                                      name="description" 
                                      rows="3" 
                                      placeholder="Brief description of your recipe...">{{ recipe.description|default:'' }}</textarea>
                        </div>

                        <div class="mb-3">
                            <label for="ingredients" class="form-label">Ingredients</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="ingredients" 
                                   name="ingredients" 
                                   value="{% if recipe %}{{ recipe.ingredients.all|join:', ' }}{% endif %}" 
                                   placeholder="e.g., flour, sugar, eggs, butter">
                            <small class="form-text text-muted">Separate ingredients with commas</small>
                        </div>

                        <div class="mb-3">
                            <label for="instructions" class="form-label">Instructions *</label>
                            <textarea class="form-control" 
                                      id="instructions" 
                                      name="instructions" 
                                      rows="8" 
                                      required 
                                      placeholder="Step 1: Preheat oven to 350Â°F&#10;Step 2: Mix dry ingredients&#10;Step 3: ...">{{ recipe.instructions|default:'' }}</textarea>
                            <small class="form-text text-muted">Write each step on a new line</small>
                        </div>

                        <div class="mb-3">
                            <label for="image" class="form-label">Recipe Image</label>
                            <input type="file" 
                                   class="form-control" 
                                   id="image" 
                                   name="image" 
                                   accept="image/*">
                            
                            {% if recipe and recipe.image %}
                                <div class="mt-3">
                                    <p class="mb-2"><strong>Current Image:</strong></p>
                                    <img src="{{ recipe.image.url }}" 
                                         class="img-thumbnail" 
                                         alt="{{ recipe.title }}" 
                                         style="max-width: 200px;">
                                </div>
                            {% endif %}
                        </div>

                        <div class="d-flex justify-content-between">
                            <a href="{% url 'profile' %}" class="btn btn-secondary">Cancel</a>
                            <button type="submit" class="btn btn-primary">Update Recipe</button>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\templates\favorites.html 
================================================================================ 
{% extends 'base.html' %}

{% block content %}
<div class="container">
    <h2 class="text-center mb-4">My Favorite Recipes</h2>

    <div class="row">
        {% for fav in favorites %}
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card recipe-card">
                    {% if fav.recipe.image %}
                        <img src="{{ fav.recipe.image.url }}" class="card-img-top" alt="{{ fav.recipe.title }}">
                    {% else %}
                        <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                            <span class="text-muted">No Image</span>
                        </div>
                    {% endif %}
                    <div class="card-body">
                        <h5 class="card-title">
                            <a href="{% url 'recipe_detail' fav.recipe.id %}">{{ fav.recipe.title }}</a>
                        </h5>
                        <p class="card-text text-muted">
                            {{ fav.recipe.description|truncatechars:100|default:"No description available" }}
                        </p>
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">By {{ fav.recipe.author.username }}</small>
                            <a href="{% url 'recipe_detail' fav.recipe.id %}" class="btn btn-sm btn-primary">View Recipe</a>
                        </div>
                    </div>
                </div>
            </div>
        {% empty %}
            <div class="col-12">
                <div class="alert alert-info text-center">
                    <h4>No Favorite Recipes Yet</h4>
                    <!-- <p>Start exploring and add recipes to your favorites!</p>
                    <a href="{% url 'home' %}" class="btn btn-primary">Browse Recipes</a> -->
                </div>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %} 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\templates\home.html 
================================================================================ 
{% extends 'base.html' %}

{% block content %}
<div class="fade-in">
    <div class="row">
        <!-- Main Content (Full Width) -->
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>
                    {% if request.GET.category %}
                        {{ request.GET.category|title }} Recipes
                    {% else %}
                        All Recipes
                    {% endif %}
                </h2>
                {% if request.GET.category %}
                <a href="{% url 'home' %}" class="btn btn-secondary btn-sm">
                    Clear Filter
                </a>
                {% endif %}
            </div>

            <!-- Search Form -->
            <div class="mb-4">
                <form method="GET" class="row">
                    {% if request.GET.category %}
                    <input type="hidden" name="category" value="{{ request.GET.category }}">
                    {% endif %}
                    <div class="col-md-10">
                        <input type="text" 
                               name="search" 
                               class="form-control" 
                               placeholder="Search by title, description, or ingredients..." 
                               value="{{ request.GET.search }}">
                    </div>
                    <div class="col-md-2">
                        <button type="submit" class="btn btn-primary w-100">
                            Search
                        </button>
                    </div>
                </form>
            </div>

            <!-- Recipe Grid -->
            <div class="row g-4">
                {% for recipe in recipes %}
                    <div class="col-lg-4 col-md-6">
                        <div class="card recipe-card">
                            {% if recipe.image %}
                                <img src="{{ recipe.image.url }}" class="card-img-top" alt="{{ recipe.title }}">
                            {% else %}
                                <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                                    <span class="text-muted">No Image</span>
                                </div>
                            {% endif %}
                            <div class="card-body">
                                <h5 class="card-title">
                                    <a href="{% url 'recipe_detail' recipe.id %}" class="recipe-card-title">
                                        {{ recipe.title }}
                                    </a>
                                </h5>
                                <p class="card-text text-muted">{{ recipe.description|truncatechars:100 }}</p>
                                
                                <!-- Ingredient Tags -->
                                <div class="mb-2">
                                    {% for ingredient in recipe.ingredients.all|slice:":3" %}
                                        <span class="badge bg-secondary me-1 mb-1">
                                            {{ ingredient.name }}
                                        </span>
                                    {% endfor %}
                                    {% if recipe.ingredients.all|length > 3 %}
                                        <span class="badge bg-secondary mb-1">
                                            +{{ recipe.ingredients.all|length|add:"-3" }} more
                                        </span>
                                    {% endif %}
                                </div>
                                
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        By {{ recipe.author.username }}
                                    </small>
                                    <!-- <a href="{% url 'recipe_detail' recipe.id %}" class="btn btn-sm btn-primary">
                                        View Recipe
                                    </a> -->
                                </div>
                            </div>
                        </div>
                    </div>
                {% empty %}
                    <div class="col-12">
                        <div class="alert alert-info text-center">
                            {% if request.GET.category %}
                                No recipes found in this category. Try another category!
                            {% else %}
                                No recipes found. Be the first to share a recipe!
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %} 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\templates\login.html 
================================================================================ 
{% extends 'base.html' %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <div class="text-center mb-4">
                        <h2>Welcome!</h2>
                        <p class="text-muted">Login to access your recipes</p>
                    </div>

                    {% if error %}
                        <div class="alert alert-danger">
                            {{ error }}
                        </div>
                    {% endif %}

                    <form method="POST">
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            <label for="username" class="form-label">Username</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="username" 
                                   name="username" 
                                   required 
                                   placeholder="Enter your username">
                        </div>

                        <div class="mb-3">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" 
                                   class="form-control" 
                                   id="password" 
                                   name="password" 
                                   required 
                                   placeholder="Enter your password">
                        </div>

                        <button type="submit" class="btn btn-primary w-100 mb-3">Login</button>
                    </form>

                    <hr>

                    <div class="text-center">
                        <p class="text-muted mb-2">Don't have an account?</p>
                        <a href="{% url 'register' %}" class="btn btn-success w-100">Create Account</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\templates\manage_recipes.html 
================================================================================ 
{% extends 'base.html' %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-12">
            <h2>Recipe Management</h2>
            <p>Manage all recipes on the platform</p>
            
            <!-- Category Filter -->
            <form method="GET" class="mb-3">
                <div class="row">
                    <div class="col-md-4">
                        <select name="category" class="form-control" onchange="this.form.submit()">
                            <option value="">All Categories</option>
                            {% for category in categories %}
                                <option value="{{ category.id }}" 
                                        {% if selected_category == category.id|stringformat:"s" %}selected{% endif %}>
                                    {{ category.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </form>
            
            {% if recipes %}
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Author</th>
                            <th>Category</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for recipe in recipes %}
                            <tr>
                                <td>
                                    <strong>{{ recipe.title }}</strong>
                                    {% if recipe.description %}
                                        <br><small class="text-muted">{{ recipe.description|truncatechars:50 }}</small>
                                    {% endif %}
                                </td>
                                <td>{{ recipe.author.username }}</td>
                                <td>
                                    {% if recipe.category %}
                                        {{ recipe.category.name }}
                                    {% else %}
                                        <span class="text-muted">No category</span>
                                    {% endif %}
                                </td>
                                <td>{{ recipe.created_at|date:"M d, Y" }}</td>
                                <td>
                                    <a href="{% url 'recipe_detail' recipe.id %}" class="btn btn-sm btn-info">View</a>
                                    <a href="{% url 'edit_recipe' recipe.id %}" class="btn btn-sm btn-primary">Edit</a>
                                    <form method="POST" action="{% url 'delete_recipe' recipe.id %}" class="d-inline">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-sm btn-danger" 
                                                onclick="return confirm('Delete this recipe?')">
                                            Delete
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <div class="alert alert-info">
                    No recipes found.
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %} 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\templates\manage_users.html 
================================================================================ 
{% extends 'base.html' %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-12">
            <h2>User Management</h2>
            <p>Manage all registered users</p>
            
            {% if users %}
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Full Name</th>
                            <th>Joined</th>
                            <th>Recipes</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in users %}
                            <tr>
                                <td>{{ user.username }}</td>
                                <td>{{ user.email }}</td>
                                <td>{{ user.get_full_name|default:"-" }}</td>
                                <td>{{ user.date_joined|date:"M d, Y" }}</td>
                                <td>{{ user.recipe_set.count }}</td>
                                <td>
                                    <form method="POST" action="{% url 'delete_user' user.id %}" class="d-inline">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-sm btn-danger" 
                                                onclick="return confirm('Are you sure you want to delete {{ user.username }}? This will also delete all their recipes.')">
                                            Delete
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <div class="alert alert-info">
                    No users found.
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %} 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\templates\profile.html 
================================================================================ 
{% extends 'base.html' %}

{% block content %}
<div class="container">
    <h2 class="text-center mb-4">My Profile</h2>

    <!-- User Info -->
    <div class="row justify-content-center mb-5">
        <div class="col-lg-6">
            <div class="card">
                <div class="card-body text-center">
                    <h3 class="mb-3">{{ user.first_name }} {{ user.last_name }}</h3>
                    <p><strong>Username:</strong> {{ user.username }}</p>
                    <p><strong>Email:</strong> {{ user.email }}</p>
                    <a href="{% url 'update_profile' %}" class="btn btn-primary mt-2">Update Profile</a>
                </div>
            </div>
        </div>
    </div>

    <!-- My Recipes Section -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3>My Recipes</h3>
        <a href="{% url 'add_recipe' %}" class="btn btn-primary">Add New Recipe</a>
    </div>

    <div class="row g-4">
        {% for recipe in user_recipes %}
            <div class="col-lg-4 col-md-6">
                <div class="card recipe-card">
                    {% if recipe.image %}
                        <img src="{{ recipe.image.url }}" class="card-img-top" alt="{{ recipe.title }}">
                    {% else %}
                        <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                            <span class="text-muted">No Image</span>
                        </div>
                    {% endif %}
                    <div class="card-body">
                        <h5 class="card-title">
                            <a href="{% url 'recipe_detail' recipe.id %}">{{ recipe.title }}</a>
                        </h5>
                        <p class="card-text text-muted">
                            {{ recipe.description|truncatechars:100|default:"No description available" }}
                        </p>
                        
                        <!-- Action Buttons -->
                        <div class="d-flex gap-2">
                            <a href="{% url 'recipe_detail' recipe.id %}" class="btn btn-sm btn-info">View</a>
                            <a href="{% url 'edit_recipe' recipe.id %}" class="btn btn-sm btn-primary">Edit</a>
                            <form method="post" action="{% url 'delete_recipe' recipe.id %}" class="d-inline">
                                {% csrf_token %}
                                <button type="submit" 
                                        onclick="return confirm('Are you sure you want to delete this recipe?');" 
                                        class="btn btn-sm btn-danger">Delete</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        {% empty %}
            <div class="col-12">
                <div class="alert alert-info text-center">
                    <h4>No Recipes Yet</h4>
                </div>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %} 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\templates\recipe_detail.html 
================================================================================ 
{% extends 'base.html' %}

{% block content %}
<div class="fade-in">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="recipe-detail-container">
                <!-- Back Button -->
                <!-- <div class="mb-3">
                    <a href="{% url 'home' %}" class="btn btn-secondary me-2">
                        Back to Recipes
                    </a>
                </div> -->
                <!-- {% if user.is_authenticated %}
                    <div class="mb-3">
                        {% if user == recipe.author %}
                            <a href="{% url 'profile' %}" class="btn btn-secondary me-2">
                                Back to Profile
                            </a>
                        {% endif %}
                    </div>
                {% endif %} -->
                <!-- Recipe Header -->
                <div class="text-center mb-4">
                    <h1 class="display-4 page-header mb-3">{{ recipe.title }}</h1>
                    <p class="text-muted">
                        Created by <strong>{{ recipe.author.username }}</strong>
                    </p>
                </div>

                <!-- Recipe Image -->
                {% if recipe.image %}
                    <img src="{{ recipe.image.url }}" 
                         class="recipe-image shadow" 
                         alt="{{ recipe.title }}">
                {% else %}
                    <div class="bg-light d-flex align-items-center justify-content-center rounded mb-4" style="height: 400px;">
                        <span class="text-muted">No Image Available</span>
                    </div>
                {% endif %}

                <!-- Description -->
                {% if recipe.description %}
                    <div class="mb-4">
                        <h3 class="h4 mb-3">Description</h3>
                        <p class="lead text-muted">{{ recipe.description }}</p>
                    </div>
                {% endif %}

                <div class="row">
                    <!-- Ingredients -->
                    <div class="col-md-5">
                        <div class="ingredients-list">
                            <h3 class="h4 mb-3">Ingredients</h3>
                            <ul class="list-unstyled">
                                {% for ingredient in recipe.ingredients.all %}
                                    <li class="mb-2">
                                        â€¢ {{ ingredient.name }}
                                    </li>
                                {% empty %}
                                    <li class="text-muted">No ingredients listed.</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>

                    <!-- Instructions -->
                    <div class="col-md-7">
                        <div class="instructions-list">
                            <h3 class="h4 mb-3">Instructions</h3>
                            <ol>
                                {% for step in recipe.instructions.splitlines %}
                                    {% if step %}
                                        <li class="mb-2">{{ step }}</li>
                                    {% endif %}
                                {% endfor %}
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                {% if user.is_authenticated %}
                    <div class="text-center mt-4" >
                        <!-- Favorite Button -->
                        {% if not user.is_superuser %}
                            <form method="post" action="{% url 'toggle_favorite' recipe.id %}" class="d-inline">
                                {% csrf_token %}
                                <button type="submit" class="btn {% if is_favorite %}btn-danger{% else %}btn-success{% endif %} me-2">
                                    {% if is_favorite %}
                                        Remove from Favorites
                                    {% else %}
                                        Add to Favorites
                                    {% endif %}
                                </button>
                            </form>
                        {% endif %}
                        <!-- Admin or Owner Controls -->
                        {% if user.is_superuser or user == recipe.author %}
                            <a href="{% url 'edit_recipe' recipe.id %}" class="btn btn-primary me-2">
                                Edit Recipe
                            </a>
                            <form method="post" action="{% url 'delete_recipe' recipe.id %}" class="d-inline">
                                {% csrf_token %}
                                <button type="submit" 
                                        class="btn btn-danger"
                                        onclick="return confirm('Are you sure you want to delete this recipe?')">
                                    Delete Recipe
                                </button>
                            </form>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %} 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\templates\register.html 
================================================================================ 
{% extends 'base.html' %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <div class="text-center mb-4">
                        <h2>Create Account</h2>
                        <p class="text-muted">Join GohanHub and share your recipes!</p>
                    </div>

                    {% if error %}
                        <div class="alert alert-danger">
                            {{ error }}
                        </div>
                    {% endif %}

                    <form method="POST">
                        {% csrf_token %}
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="firstname" class="form-label">First Name</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="firstname" 
                                       name="firstname" 
                                       required 
                                       placeholder="John">
                            </div>
                            <div class="col-md-6">
                                <label for="lastname" class="form-label">Last Name</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="lastname" 
                                       name="lastname" 
                                       required 
                                       placeholder="Doe">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" 
                                   class="form-control" 
                                   id="email" 
                                   name="email" 
                                   required 
                                   placeholder="john.doe@example.com">
                        </div>

                        <div class="mb-3">
                            <label for="username" class="form-label">Username</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="username" 
                                   name="username" 
                                   required 
                                   placeholder="Choose a username">
                        </div>

                        <div class="mb-3">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" 
                                   class="form-control" 
                                   id="password" 
                                   name="password" 
                                   required 
                                   placeholder="Create a strong password">
                            <small class="form-text text-muted">Use at least 8 characters with letters and numbers</small>
                        </div>

                        <button type="submit" class="btn btn-primary w-100 mb-3">Create Account</button>
                    </form>

                    <hr>

                    <div class="text-center">
                        <p class="text-muted mb-2">Already have an account?</p>
                        <a href="{% url 'login' %}" class="btn btn-success w-100">Login</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\templates\update_profile.html 
================================================================================ 
{% extends 'base.html' %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-6">
            <h2 class="text-center mb-4">Update Profile</h2>
            
            <div class="card">
                <div class="card-body">
                    <form method="POST">
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            <label for="firstname" class="form-label">First Name</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="firstname" 
                                   name="firstname" 
                                   value="{{ user.first_name }}" 
                                   required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="lastname" class="form-label">Last Name</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="lastname" 
                                   name="lastname" 
                                   value="{{ user.last_name }}" 
                                   required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" 
                                   class="form-control" 
                                   id="email" 
                                   name="email" 
                                   value="{{ user.email }}" 
                                   required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Username</label>
                            <input type="text" 
                                   class="form-control" 
                                   value="{{ user.username }}" 
                                   disabled>
                            <small class="text-muted">Username cannot be changed</small>
                        </div>
                        
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">Update Profile</button>
                            <a href="{% url 'profile' %}" class="btn btn-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\templates\emails\welcome.html 
================================================================================ 
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Welcome to GohanHub</title>
    <style>
      body { font-family: Arial, sans-serif; color: #333; }
      .container { max-width: 600px; margin: 0 auto; padding: 20px; }
      .btn { display: inline-block; padding: 10px 16px; background:#2563eb; color: white; text-decoration:none; border-radius:6px }
      .footer { font-size: 12px; color: #777; margin-top: 20px }
    </style>
  </head>
  <body>
    <div class="container">
      <img src="{{ site_url }}/static/images/logo.png" alt="GohanHub" style="height:48px;">
      <h1>Welcome to GohanHub, {{ username }}!</h1>
      <p>Thank you for joining our community of food lovers. We're excited to have you.</p>
      <p>Get started:</p>
      <ul>
        <li>Share your first recipe</li>
        <li>Explore recipes from other users</li>
        <li>Follow cooks whose food you love</li>
      </ul>
      <p>
        <a href="{{ site_url }}/explore" class="btn">Explore Recipes</a>
      </p>
      <p class="footer">If you didn't sign up for this account, you can ignore this email.</p>
    </div>
  </body>
</html>
 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\users\serializers.py 
================================================================================ 
from django.contrib.auth import get_user_model
from rest_framework import serializers
from dj_rest_auth.serializers import LoginSerializer
from dj_rest_auth.registration.serializers import RegisterSerializer
from django.contrib.auth.password_validation import validate_password
from django.core.exceptions import ValidationError as DjangoValidationError


User = get_user_model()


class CustomUserSerializer(serializers.ModelSerializer):
    """
    Custom user serializer that includes username and email for display.
    Used for user profile and authentication responses.
    """
    class Meta:
        model = User
        fields = ['id', 'username', 'email', 'first_name', 'last_name']
        read_only_fields = ['id']


class CustomLoginSerializer(LoginSerializer):
    """
    Custom login serializer that uses email instead of username.
    This works with the EmailAuthenticationBackend in settings.
    """
    username = None  # Remove username field
    email = serializers.EmailField(required=True)
    
    def validate(self, attrs):
        """Override to use email for authentication."""
        email = attrs.get('email')
        password = attrs.get('password')
        
        if email and password:
            # The actual authentication happens in the parent class
            # but we're passing email through the username field internally
            attrs['username'] = email
        
        return super().validate(attrs)


class CustomRegisterSerializer(RegisterSerializer):
    """
    Custom registration serializer that requires username, email, and password.
    Users must choose their own unique username.
    """
    username = serializers.CharField(
        required=True,
        max_length=150,
        min_length=3,
        help_text="Required. 3-150 characters. Letters, digits and @/./+/-/_ only.",
        error_messages={
            'required': 'Username is required.',
            'min_length': 'Username must be at least 3 characters long.',
            'max_length': 'Username cannot exceed 150 characters.',
        }
    )
    
    email = serializers.EmailField(
        required=True,
        error_messages={
            'required': 'Email address is required.',
            'invalid': 'Please enter a valid email address.',
        }
    )
    
    password1 = serializers.CharField(
        write_only=True,
        required=True,
        style={'input_type': 'password'},
        error_messages={
            'required': 'Password is required.',
        }
    )
    
    password2 = serializers.CharField(
        write_only=True,
        required=True,
        style={'input_type': 'password'},
        error_messages={
            'required': 'Password confirmation is required.',
        }
    )

    def validate_username(self, value):
        """
        Validate that username is unique and meets requirements.
        """
        # Check if username already exists
        if User.objects.filter(username=value).exists():
            raise serializers.ValidationError(
                "A user with that username already exists."
            )
        
        # Check for valid characters (letters, numbers, @, ., +, -, _)
        import re
        if not re.match(r'^[a-zA-Z0-9@.+_-]+$', value):
            raise serializers.ValidationError(
                "Username can only contain letters, numbers, and @/./+/-/_ characters."
            )
        
        return value

    def validate_email(self, value):
        """
        Validate that email is unique.
        """
        if User.objects.filter(email=value.lower()).exists():
            raise serializers.ValidationError(
                "A user with that email address already exists."
            )
        
        return value.lower()

    def validate_password1(self, value):
        """
        Validate password using Django's password validators.
        """
        try:
            validate_password(value)
        except DjangoValidationError as e:
            raise serializers.ValidationError(list(e.messages))
        
        return value

    def validate(self, attrs):
        """
        Validate that passwords match.
        """
        if attrs.get('password1') != attrs.get('password2'):
            raise serializers.ValidationError({
                'password2': 'Password fields did not match.'
            })
        
        return attrs

    def get_cleaned_data(self):
        """
        Return cleaned data for user creation.
        This is used by dj-rest-auth to create the user.
        """
        return {
            'username': self.validated_data.get('username', ''),
            'email': self.validated_data.get('email', ''),
            'password1': self.validated_data.get('password1', ''),
            'password2': self.validated_data.get('password2', ''),
        }
    
    def save(self, request):
        """
        Save and return the new user instance.
        """
        user = super().save(request)
        return user

    class Meta:
        model = User
        fields = ['username', 'email', 'password1', 'password2'] 
================================================================================ 
C:\Users\itssu\OneDrive\Desktop\Main_project\gohanhub\users\__init__.py 
================================================================================ 
